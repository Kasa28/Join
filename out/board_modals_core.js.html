<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: board_modals_core.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: board_modals_core.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* === board_modals_core.js | Handles opening and closing of task and add-task modals === */

/**
 * Opens the task modal for a given task ID.
 * Looks up the task, collects DOM elements and delegates opening.
 * @param {number} id - Task ID to open in the modal.
 */
function openModalById(id) {
  const task = findTaskById(id);
  if (!task) {
    return;
  }
  const els = getTaskModalElements();
  if (!els) {
    return;
  }
  openTaskModalWithTask(task, id, els);
}
window.openModalById = openModalById;

/**
 * Finds a task with a given ID in the global tasks array.
 * @param {number} id - ID of the task.
 * @returns {Task|null} The found task or null.
 */
function findTaskById(id) {
  if (!Array.isArray(window.tasks)) {
    return null;
  }
  for (let i = 0; i &lt; window.tasks.length; i++) {
    const t = window.tasks[i];
    if (t &amp;&amp; t.id === id) {
      return t;
    }
  }
  return null;
}

/**
 * Returns modal container and content elements for the task modal.
 * @returns {{modal: HTMLElement, content: HTMLElement}|null}
 */
function getTaskModalElements() {
  const modal = document.getElementById("task-modal");
  const content = document.getElementById("task-modal-content");
  if (!modal || !content) {
    return null;
  }
  return { modal, content };
}

/**
 * Ensures the CSS for user-story big cards is loaded once.
 */
function ensureUserStoryCss() {
  const link = document.getElementById("user-story-css");
  if (link) {
    return;
  }
  const css = document.createElement("link");
  css.id = "user-story-css";
  css.rel = "stylesheet";
  css.href = "../board_code/user_story_template.css";
  document.head.appendChild(css);
}

/**
 * Ensures the CSS for technical big cards is loaded once.
 */
function ensureTechnicalCss() {
  const link = document.getElementById("technical-css");
  if (link) {
    return;
  }
  const css = document.createElement("link");
  css.id = "technical-css";
  css.rel = "stylesheet";
  css.href = "../styles/board-technical.css";
  document.head.appendChild(css);
}

/**
 * Chooses between dynamic and legacy modal rendering for a task.
 * @param {Task} task - Task object to show.
 * @param {number} id - Task ID.
 * @param {{modal: HTMLElement, content: HTMLElement}} els - Modal elements.
 */
function openTaskModalWithTask(task, id, els) {
  const modal = els.modal;
  const content = els.content;
  const type = task.type;
  const isTech = isTechnicalType(type);
  const isStory = isUserStoryType(type);
  if (task.id > 1000 &amp;&amp; typeof bigCardDynamicHtml === "function") {
    openDynamicTaskModal(task, modal, content, isTech, isStory);
  } else {
    openLegacyTaskModal(task, id, modal, content, isTech);
  }
}

/**
 * Opens the dynamic big-card modal (user-story or technical).
 * @param {Task} task
 * @param {HTMLElement} modal
 * @param {HTMLElement} content
 * @param {boolean} isTech
 * @param {boolean} isStory
 */
function openDynamicTaskModal(task, modal, content, isTech, isStory) {
  if (isStory) {
    ensureUserStoryCss();
  }
  if (isTech) {
    ensureTechnicalCss();
  }
  if (isTech &amp;&amp; typeof bigCardDynamicTechnicalHtml === "function") {
    content.innerHTML = bigCardDynamicTechnicalHtml(task);
  } else {
    content.innerHTML = bigCardDynamicHtml(task);
  }
  modal.style.display = "flex";
  document.body.classList.add("no-scroll");
}

/**
 * Ensures the correct CSS file is loaded for legacy templates.
 * @param {boolean} isTech - True for technical task.
 */
function ensureCssForLegacy(isTech) {
  if (!isTech) {
    ensureUserStoryCss();
  }
  if (isTech) {
    ensureTechnicalCss();
  }
}

/**
 * Returns the HTML for legacy task templates.
 * @param {Task} task
 * @param {boolean} isTech
 * @returns {string} HTML string for the modal content.
 */
function getLegacyTaskHtml(task, isTech) {
  if (isTech &amp;&amp; typeof getTechnicalTaskTemplate === "function") {
    return getTechnicalTaskTemplate(task);
  }
  if (typeof bigCardHtml === "function") {
    return bigCardHtml(task);
  }
  return fallbackModal(task);
}

/**
 * Restores saved checkbox states for subtasks in the modal.
 * @param {number} id - Task ID.
 * @param {HTMLElement} content - Modal content element.
 */
function restoreSubtasksState(id, content) {
  if (typeof saved === "undefined") { return; }
  const s = saved[id];
  if (!s) { return; }
  const boxes = content.querySelectorAll(
    '.subtask-list input[type="checkbox"]'
  );
  for (let i = 0; i &lt; boxes.length; i++) {
    boxes[i].checked = !!s[i];
  }
  if (boxes.length) {
    updateSubtasks(id, boxes[0]);
  }
}

/**
 * Opens the legacy task modal and restores subtasks.
 * @param {Task} task
 * @param {number} id
 * @param {HTMLElement} modal
 * @param {HTMLElement} content
 * @param {boolean} isTech
 */
function openLegacyTaskModal(task, id, modal, content, isTech) {
  ensureCssForLegacy(isTech);
  const html = getLegacyTaskHtml(task, isTech);
  content.innerHTML = html;
  restoreSubtasksState(id, content);
  modal.style.display = "flex";
  document.body.classList.add("no-scroll");
}

/**
 * Closes the task modal and restores scrolling.
 */
function closeModal() {
  const modal = document.getElementById("task-modal");
  if (modal) {
    modal.style.display = "none";
  }
  document.body.classList.remove("no-scroll");
}

/**
 * Wrapper for closing the task modal.
 * Can be used directly in HTML onclick attributes.
 */
function closeTaskModal() {
  closeModal();
}

/**
 * Ensures CSS for the Add Task overlay is loaded once.
 */
function ensureAddTaskCss() {
  const link = document.getElementById("addtask-css");
  if (link) {
    return;
  }
  const css = document.createElement("link");
  css.id = "addtask-css";
  css.rel = "stylesheet";
  css.href = "./addTask_template.css";
  document.head.appendChild(css);
}

/**
 * Returns the HTML for the Add Task template or a fallback message.
 * @returns {string} HTML for the Add Task overlay.
 */
function getAddTaskHtml() {
  if (typeof getAddTaskTemplate === "function") {
    return getAddTaskTemplate();
  }
  return '&lt;div style="padding:16px">AddTask-Template fehlt.&lt;/div>';
}

/**
 * Fills the Add Task content, renders contacts and sets focus.
 * @param {HTMLElement} content - Container for the Add Task template.
 */
function setupAddTaskContent(content) {
  content.innerHTML = getAddTaskHtml();
  renderContactsInDropdown();
  if (typeof initAddTaskTemplateHandlers === "function") {
    initAddTaskTemplateHandlers();
  }
  const titleInput = content.querySelector("#title");
  if (titleInput) {
    titleInput.focus();
  }
}

/**
 * Opens the Add Task overlay and prevents background scrolling.
 */
function openAddTask() {
  const overlay = document.getElementById("addtask-overlay");
  const content = document.getElementById("addtask-content");
  if (!overlay || !content) {
    return;
  }
  ensureAddTaskCss();
  setupAddTaskContent(content);
  overlay.classList.add("open");
  document.body.classList.add("no-scroll");
}

/**
 * Resets global helper variables used by the Add Task overlay.
 */
function resetAddTaskGlobals() {
  window.taskBeingEdited = null;
  window.selectedUsers = [];
  window.selectedUserColors = {};
  window.isDropdownOpen = false;
}

/**
 * Clears Add Task content and removes injected CSS after animation.
 */
function clearAddTaskAfterAnimation() {
  const content = document.getElementById("addtask-content");
  if (!content) {
    return;
  }
  content.innerHTML = "";
  const css = document.getElementById("addtask-css");
  if (css) {
    css.remove();
  }
}

/**
 * Closes the Add Task overlay and restores the page state.
 */
function closeAddTask() {
  const overlay = document.getElementById("addtask-overlay");
  const content = document.getElementById("addtask-content");
  if (!overlay || !content) {
    return;
  }
  overlay.classList.remove("open");
  document.body.classList.remove("no-scroll");
  resetAddTaskGlobals();
  setTimeout(clearAddTaskAfterAnimation, 300);
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#BASE_URL">BASE_URL</a></li><li><a href="global.html#activeHighlightColumnId">activeHighlightColumnId</a></li><li><a href="global.html#addActiveClassToSidebarButtons">addActiveClassToSidebarButtons</a></li><li><a href="global.html#addNewContact">addNewContact</a></li><li><a href="global.html#afterRender">afterRender</a></li><li><a href="global.html#applyStatusChangeForDraggedTask">applyStatusChangeForDraggedTask</a></li><li><a href="global.html#assignedToDataExtractSafe">assignedToDataExtractSafe</a></li><li><a href="global.html#autoMoveTimeoutId">autoMoveTimeoutId</a></li><li><a href="global.html#bigCardDynamicHtml">bigCardDynamicHtml</a></li><li><a href="global.html#bigCardDynamicTechnicalHtml">bigCardDynamicTechnicalHtml</a></li><li><a href="global.html#bigCardHtml">bigCardHtml</a></li><li><a href="global.html#buildSubtaskListItem">buildSubtaskListItem</a></li><li><a href="global.html#callWhiteScreen">callWhiteScreen</a></li><li><a href="global.html#canDeleteTask">canDeleteTask</a></li><li><a href="global.html#cancelScheduledAutoMove">cancelScheduledAutoMove</a></li><li><a href="global.html#checkIfBlockIsFilled">checkIfBlockIsFilled</a></li><li><a href="global.html#checkLogin">checkLogin</a></li><li><a href="global.html#checkPolicyandAnswers">checkPolicyandAnswers</a></li><li><a href="global.html#clearAddTaskAfterAnimation">clearAddTaskAfterAnimation</a></li><li><a href="global.html#clearAllColumnHighlights">clearAllColumnHighlights</a></li><li><a href="global.html#closeAddTask">closeAddTask</a></li><li><a href="global.html#closeModal">closeModal</a></li><li><a href="global.html#closeTaskModal">closeTaskModal</a></li><li><a href="global.html#closeWhiteScreen">closeWhiteScreen</a></li><li><a href="global.html#collectTaskFromForm">collectTaskFromForm</a></li><li><a href="global.html#contactBlock">contactBlock</a></li><li><a href="global.html#createTask">createTask</a></li><li><a href="global.html#currentDragCardEl">currentDragCardEl</a></li><li><a href="global.html#currentlySelectedContact">currentlySelectedContact</a></li><li><a href="global.html#deleteContact">deleteContact</a></li><li><a href="global.html#deleteContactinEditContactWindow">deleteContactinEditContactWindow</a></li><li><a href="global.html#deleteDynamicTask">deleteDynamicTask</a></li><li><a href="global.html#deleteIdFromLocalStorage">deleteIdFromLocalStorage</a></li><li><a href="global.html#deleteTaskFromArray">deleteTaskFromArray</a></li><li><a href="global.html#deleteTaskOnServer">deleteTaskOnServer</a></li><li><a href="global.html#demoTasks">demoTasks</a></li><li><a href="global.html#editContact">editContact</a></li><li><a href="global.html#emptyTheAddContactFormular">emptyTheAddContactFormular</a></li><li><a href="global.html#ensureAddTaskCss">ensureAddTaskCss</a></li><li><a href="global.html#ensureBoardAuth">ensureBoardAuth</a></li><li><a href="global.html#ensureCssForLegacy">ensureCssForLegacy</a></li><li><a href="global.html#ensureTechnicalCss">ensureTechnicalCss</a></li><li><a href="global.html#ensureToastRoot">ensureToastRoot</a></li><li><a href="global.html#ensureUserStoryCss">ensureUserStoryCss</a></li><li><a href="global.html#fallbackModal">fallbackModal</a></li><li><a href="global.html#fetchBoardTasks">fetchBoardTasks</a></li><li><a href="global.html#findColumnByPointer">findColumnByPointer</a></li><li><a href="global.html#findIndexFromUsername">findIndexFromUsername</a></li><li><a href="global.html#findTaskById">findTaskById</a></li><li><a href="global.html#findTaskForModal">findTaskForModal</a></li><li><a href="global.html#generateTaskId">generateTaskId</a></li><li><a href="global.html#getAddTaskHtml">getAddTaskHtml</a></li><li><a href="global.html#getAddTaskTemplate">getAddTaskTemplate</a></li><li><a href="global.html#getBadgeClass">getBadgeClass</a></li><li><a href="global.html#getBasePath">getBasePath</a></li><li><a href="global.html#getBigCardDynamicHtml">getBigCardDynamicHtml</a></li><li><a href="global.html#getBigCardDynamicTechnicalHtml">getBigCardDynamicTechnicalHtml</a></li><li><a href="global.html#getBoardAuthQuery">getBoardAuthQuery</a></li><li><a href="global.html#getContactColorType">getContactColorType</a></li><li><a href="global.html#getCurrentUidOrThrow">getCurrentUidOrThrow</a></li><li><a href="global.html#getDraggedTask">getDraggedTask</a></li><li><a href="global.html#getFriendsForCurrentUser">getFriendsForCurrentUser</a></li><li><a href="global.html#getInitials">getInitials</a></li><li><a href="global.html#getInitialsFromName">getInitialsFromName</a></li><li><a href="global.html#getLegacyTaskHtml">getLegacyTaskHtml</a></li><li><a href="global.html#getNextDeadline">getNextDeadline</a></li><li><a href="global.html#getRandomInt">getRandomInt</a></li><li><a href="global.html#getSignupValues">getSignupValues</a></li><li><a href="global.html#getSubtasksSafe">getSubtasksSafe</a></li><li><a href="global.html#getSummaryFetchConfig">getSummaryFetchConfig</a></li><li><a href="global.html#getTaskCounts">getTaskCounts</a></li><li><a href="global.html#getTaskForDelete">getTaskForDelete</a></li><li><a href="global.html#getTaskModalElements">getTaskModalElements</a></li><li><a href="global.html#getTechnicalTaskTemplate">getTechnicalTaskTemplate</a></li><li><a href="global.html#getUserFriendslistByUid">getUserFriendslistByUid</a></li><li><a href="global.html#getValidationState">getValidationState</a></li><li><a href="global.html#getWhiteScreen">getWhiteScreen</a></li><li><a href="global.html#greetUserName">greetUserName</a></li><li><a href="global.html#handleAddContact">handleAddContact</a></li><li><a href="global.html#handleContactClick">handleContactClick</a></li><li><a href="global.html#hideAddContactFormular">hideAddContactFormular</a></li><li><a href="global.html#hideEditContactFormular">hideEditContactFormular</a></li><li><a href="global.html#hideToastLater">hideToastLater</a></li><li><a href="global.html#hydrateAssignSection">hydrateAssignSection</a></li><li><a href="global.html#isDemoTask">isDemoTask</a></li><li><a href="global.html#isPublicPage">isPublicPage</a></li><li><a href="global.html#isTechnicalType">isTechnicalType</a></li><li><a href="global.html#isUserStoryType">isUserStoryType</a></li><li><a href="global.html#isValidName">isValidName</a></li><li><a href="global.html#jumpToLogin">jumpToLogin</a></li><li><a href="global.html#lastDragPointerX">lastDragPointerX</a></li><li><a href="global.html#loadTasks">loadTasks</a></li><li><a href="global.html#loadTasksFromFirebase">loadTasksFromFirebase</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#makeFirstLetterBig">makeFirstLetterBig</a></li><li><a href="global.html#mapCategoryToType">mapCategoryToType</a></li><li><a href="global.html#matchesSearch">matchesSearch</a></li><li><a href="global.html#nameOfTheCard">nameOfTheCard</a></li><li><a href="global.html#needsDraggingClassAfterRender">needsDraggingClassAfterRender</a></li><li><a href="global.html#normaliseSubtaskProgress">normaliseSubtaskProgress</a></li><li><a href="global.html#normalizeTaskType">normalizeTaskType</a></li><li><a href="global.html#onclickFunction">onclickFunction</a></li><li><a href="global.html#onloadFunctionHeader">onloadFunctionHeader</a></li><li><a href="global.html#openAddTask">openAddTask</a></li><li><a href="global.html#openDynamicTaskModal">openDynamicTaskModal</a></li><li><a href="global.html#openEditOverlay">openEditOverlay</a></li><li><a href="global.html#openLegacyTaskModal">openLegacyTaskModal</a></li><li><a href="global.html#openModalById">openModalById</a></li><li><a href="global.html#openModalDynamic">openModalDynamic</a></li><li><a href="global.html#openTaskModalWithTask">openTaskModalWithTask</a></li><li><a href="global.html#parseDueDate">parseDueDate</a></li><li><a href="global.html#pendingAutoMoveStatus">pendingAutoMoveStatus</a></li><li><a href="global.html#pendingDragTiltClass">pendingDragTiltClass</a></li><li><a href="global.html#persistContacts">persistContacts</a></li><li><a href="global.html#persistTasks">persistTasks</a></li><li><a href="global.html#pollSummary">pollSummary</a></li><li><a href="global.html#prepareEditState">prepareEditState</a></li><li><a href="global.html#prevOnload">prevOnload</a></li><li><a href="global.html#priorit%25C3%25A4tIcon">prioritätIcon</a></li><li><a href="global.html#pushExampleContactsOneTimeInLocalStorage">pushExampleContactsOneTimeInLocalStorage</a></li><li><a href="global.html#putUsernameInContactList">putUsernameInContactList</a></li><li><a href="global.html#removeContentfromAllContactBlocks">removeContentfromAllContactBlocks</a></li><li><a href="global.html#removeTaskCard">removeTaskCard</a></li><li><a href="global.html#render">render</a></li><li><a href="global.html#renderAddContact">renderAddContact</a></li><li><a href="global.html#renderCard">renderCard</a></li><li><a href="global.html#renderContactList">renderContactList</a></li><li><a href="global.html#renderEditContact">renderEditContact</a></li><li><a href="global.html#renderModalContent">renderModalContent</a></li><li><a href="global.html#renderSingleContact">renderSingleContact</a></li><li><a href="global.html#renderUserMenuePopupMenu">renderUserMenuePopupMenu</a></li><li><a href="global.html#requestBoardRender">requestBoardRender</a></li><li><a href="global.html#resetAddTaskGlobals">resetAddTaskGlobals</a></li><li><a href="global.html#resetError">resetError</a></li><li><a href="global.html#restoreSubtasksState">restoreSubtasksState</a></li><li><a href="global.html#saveTaskEdits">saveTaskEdits</a></li><li><a href="global.html#scheduleAutoMoveTo">scheduleAutoMoveTo</a></li><li><a href="global.html#searchQuery">searchQuery</a></li><li><a href="global.html#seedDemoFriendsIfEmpty">seedDemoFriendsIfEmpty</a></li><li><a href="global.html#setActiveSidebarByURL">setActiveSidebarByURL</a></li><li><a href="global.html#setContactsIntoContactblock">setContactsIntoContactblock</a></li><li><a href="global.html#setLetterInUserBall">setLetterInUserBall</a></li><li><a href="global.html#setSummaryText">setSummaryText</a></li><li><a href="global.html#setUserDataValue">setUserDataValue</a></li><li><a href="global.html#setupAddTaskContent">setupAddTaskContent</a></li><li><a href="global.html#showAddContactFormular">showAddContactFormular</a></li><li><a href="global.html#showContactToast">showContactToast</a></li><li><a href="global.html#showEditContactFormular">showEditContactFormular</a></li><li><a href="global.html#showError">showError</a></li><li><a href="global.html#showTaskModal">showTaskModal</a></li><li><a href="global.html#showToast">showToast</a></li><li><a href="global.html#singleContactTemplate">singleContactTemplate</a></li><li><a href="global.html#sortUserToAlphabeticalOrder">sortUserToAlphabeticalOrder</a></li><li><a href="global.html#startEditTask">startEditTask</a></li><li><a href="global.html#startSummaryPolling">startSummaryPolling</a></li><li><a href="global.html#statusByColumnId">statusByColumnId</a></li><li><a href="global.html#toggleContactHighlight">toggleContactHighlight</a></li><li><a href="global.html#toggleUserMenuePopupMenu">toggleUserMenuePopupMenu</a></li><li><a href="global.html#updateButtonState">updateButtonState</a></li><li><a href="global.html#updateErrorForSignup">updateErrorForSignup</a></li><li><a href="global.html#updateFriendsForCurrentUser">updateFriendsForCurrentUser</a></li><li><a href="global.html#updateSearchClearButtonState">updateSearchClearButtonState</a></li><li><a href="global.html#updateSummary">updateSummary</a></li><li><a href="global.html#updateTimeout">updateTimeout</a></li><li><a href="global.html#updateUserFriendslistByUid">updateUserFriendslistByUid</a></li><li><a href="global.html#updateUserMenuPosition">updateUserMenuPosition</a></li><li><a href="global.html#userMenuTemplate">userMenuTemplate</a></li><li><a href="global.html#validateEmailInForm">validateEmailInForm</a></li><li><a href="global.html#validateEmailOnSubmit">validateEmailOnSubmit</a></li><li><a href="global.html#validateNameAndPasswordOnSubmit">validateNameAndPasswordOnSubmit</a></li><li><a href="global.html#whichCardActuellDrop">whichCardActuellDrop</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Wed Dec 10 2025 16:29:03 GMT+0100 (Mitteleuropäische Normalzeit)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
