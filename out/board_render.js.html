<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: board_render.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: board_render.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* === board_render.js | Handles rendering of task cards and visuals === */
/**
 * @typedef {Object} AssignedUser
 * @property {string} name
 * @property {string} [img]
 * @property {string} [color]
 */
/**
 * @typedef {"todo"|"in-progress"|"await-feedback"|"done"} TaskStatus
 */
/**
 * @typedef {"urgent"|"medium"|"low"} TaskPriority
 */
/**
 * @typedef {Object} Task
 * @property {number|string} id
 * @property {string} title
 * @property {string} description
 * @property {string} type
 * @property {TaskStatus} status
 * @property {string} dueDate
 * @property {TaskPriority} priority
 * @property {string} [priorityIcon]
 * @property {number} subtasksDone
 * @property {number} subtasksTotal
 * @property {AssignedUser[]} assignedTo
 * @property {string[]} [subTasks]
 */
/**
 * Renders a single task into a cloned card template.
 * @param {Task} t
 * @returns {DocumentFragment}
 */

function renderCard(t) {
  const tpl = document.getElementById("tmpl-card").content.cloneNode(true);
  const card = tpl.querySelector(".task-card");
  const menuBtn = document.createElement("button");
  menuBtn.classList.add("mobile-move-btn");
  menuBtn.innerHTML = "⋮";
  menuBtn.onclick = (ev) => openMoveMenu(ev, t.id);
  card.appendChild(menuBtn);
  card.id = `card-${t.id}`;
  card.draggable = true;
  card.ondragstart = (e) => onCardDragStart(e, t.id);
  card.ondragend = onCardDragEnd;
  card.onclick = (event) => {
    event.stopPropagation();
    openModalById(Number(t.id));
  };
  const badge = tpl.querySelector(".badge");
  if (badge) {
    badge.textContent = t.type;
    badge.classList.add(getBadgeClass(t.type));
  }
  const h3 = tpl.querySelector("h3");
  if (h3) h3.textContent = t.title;
  const p = tpl.querySelector("p");
  if (p) p.textContent = t.description;
  const fill = tpl.querySelector(".progress-fill");
  const track = tpl.querySelector(".progress-track");
  const st = tpl.querySelector(".subtasks");
  const total = Number(t.subtasksTotal) || 0;
  const hasSubtasks = total > 0;
  const pct = hasSubtasks ? Math.round((t.subtasksDone / total) * 100) : 0;
  if (track) track.style.display = hasSubtasks ? "" : "none";
  if (fill) fill.style.width = pct + "%";
  if (st) {
    st.style.display = hasSubtasks ? "" : "none";
    st.textContent = hasSubtasks ? `${t.subtasksDone}/${total} Subtasks` : "";
  }
  return tpl;
}

/* === Subtask List Item Builder === */
/**
 * Builds a subtask list &lt;li> element for edit UI.
 * @param {string} text
 * @returns {HTMLLIElement}
 */
function buildSubtaskListItem(text) {
  const li = document.createElement("li");
  li.classList.add("subtask-entry-edit");
  li.textContent = text;
  const actions = document.createElement("div");
  actions.classList.add("subtask-actions-addTask_template");
  actions.innerHTML = `
          &lt;img src="../assets/img/edit.svg"   alt="Edit subtask"   class="subtask-edit-addTask_template">
          &lt;div class="subtask-divider-addTask_template">&lt;/div>
          &lt;img src="../assets/img/delete.svg" alt="Delete subtask" class="subtask-remove-addTask_template">
        `;
  li.appendChild(actions);
  return li;
}

/* === Board Rendering === */
/**
 * Renders all board columns and visible task cards.
 * Respects current search filter and empty-column pills.
 * @returns {void}
 */
function render() {
  const tasks = Array.isArray(window.tasks) ? window.tasks : [];
  Object.values(nameOfTheCard).forEach(({ id }) =>
    document.getElementById(id)?.replaceChildren()
  );
  for (const t of tasks) {
    if (!matchesSearch(t)) continue;
    const host = document.getElementById(nameOfTheCard[t.status]?.id);
    if (host) host.appendChild(renderCard(t));
  }
  for (const { id, empty } of Object.values(nameOfTheCard)) {
    const col = document.getElementById(id);
    if (col &amp;&amp; !col.children.length) {
      col.innerHTML = `&lt;div class="empty-pill">${empty}&lt;/div>`;
    }
  }
  requestAnimationFrame(afterRender);
}

/* === Post-Render Enhancements (Avatars &amp; Priority Icons) === */
/**
 * Post-render pass to inject assignee avatars/initials and priority icons.
 * @returns {void}
 */
function afterRender() {
  const tasks = Array.isArray(window.tasks) ? window.tasks : [];
  document.querySelectorAll(".task-card").forEach((card) => {
    const task = tasks.find((t) => t.id == card.id.replace("card-", ""));
    if (!task) return;
    const assBox = card.querySelector(".assignees");
    if (assBox) {
      const people = task.assignedTo || [];
      const maxVisible = 3;
      const visible = people.slice(0, maxVisible);
      assBox.innerHTML = visible
        .map((p) => {
          const initials = p.name
            .split(/\s+/)
            .filter(Boolean)
            .slice(0, 2)
            .map((n) => n[0]?.toUpperCase() || "")
            .join("");
          const bg = p.color ? `background-color:${p.color};` : "";
          return `&lt;span class="assigned-to-initials" title="${p.name}" style="${bg}">${initials}&lt;/span>`;
        })
        .join("");
      if (people.length > maxVisible) {
        const extra = people.length - maxVisible;
        assBox.innerHTML += `&lt;span class="assigned-to-initials"
              style="
                background-color: #d1d1d1;
                color: black;
                font-weight: 600;
              ">+${extra}&lt;/span>`;
      }
    }
    const pill = card.querySelector(".priority-pill");
    if (pill) {
      const pr = (task.priority || "low").toLowerCase();
      const iconSrc =
        task.priorityIcon || prioritätIcon[pr] || prioritätIcon.low;
      pill.innerHTML = `&lt;img src="${iconSrc}" alt="${pr}" class="prio-icon">`;
    }
  });
}
if (needsDraggingClassAfterRender &amp;&amp; whichCardActuellDrop != null) {
  const card = document.getElementById(`card-${whichCardActuellDrop}`);
  if (card) {
    currentDragCardEl = card;
    card.classList.add("is-dragging");
    if (pendingDragTiltClass) {
      card.classList.add(pendingDragTiltClass);
    }
  }
  needsDraggingClassAfterRender = false;
  pendingDragTiltClass = null;
}

/* === Helper: Name Initials === */
/**
 * Creates initials from a full name (max 2 letters).
 * @param {string} name
 * @returns {string}
 */
function getInitialsFromName(name) {
  return String(name || "")
    .split(/\s+/)
    .filter(Boolean)
    .map((part) => part[0]?.toUpperCase() || "")
    .slice(0, 2)
    .join("");
}

/* === Helper: Populate Assign Section === */
/**
 * Hydrates the assign section in AddTask overlay based on task data.
 * @param {Task} task
 * @returns {void}
 */
function hydrateAssignSection(task) {
  const content = document.getElementById("addtask-content");
  if (!content) return;
  // Avatare
  const container = content.querySelector("#assigned-avatars");
  if (container) {
    container.innerHTML = "";
    (task.assignedTo || []).forEach((person) => {
      const name = person?.name || "";
      const color = person?.color || "#4589ff";
      const initials = getInitialsFromName(name);
      const avatar = document.createElement("div");
      avatar.textContent = initials;
      avatar.classList.add(
        "assign-avatar-addTask_template",
        "assign-avatar-addTask_page"
      );
      avatar.style.backgroundColor = color;
      avatar.dataset.fullName = name;
      avatar.dataset.color = color;
      avatar.title = name;
      container.appendChild(avatar);
    });
  }
  // Checkboxen synchronisieren
  const items = content.querySelectorAll(".assign-item-addTask_template");
  items.forEach((item) => {
    const name = item
      .querySelector(".assign-name-addTask_template")
      ?.textContent.trim();
    const checkbox = item.querySelector(".assign-check-addTask_template");
    const selected = (window.selectedUsers || []).includes(name);
    if (checkbox) checkbox.checked = selected;
    item.classList.toggle("selected", selected);
  });

  const placeholder = content.querySelector(
    ".assign-placeholder-addTask_template"
  );
  if (placeholder) {
    placeholder.textContent = (window.selectedUsers || []).length
      ? ""
      : "Select contact to assign";
    placeholder.style.color = "black";
  }
}

/* === Task Type and Badge Helpers === */
/**
 * Normalizes a task type string for comparisons.
 * @param {string} type
 * @returns {string}
 */
function normalizeTaskType(type) {
  return String(type || "")
    .trim()
    .toLowerCase();
}

/**
 * Checks if type represents a user story.
 * @param {string} type
 * @returns {boolean}
 */
function isUserStoryType(type) {
  const n = normalizeTaskType(type);
  return n === "user story" || n === "user-story";
}

/**
 * Checks if type represents a technical task.
 * @param {string} type
 * @returns {boolean}
 */
function isTechnicalType(type) {
  return normalizeTaskType(type) === "technical task";
}

/**
 * Returns badge CSS class based on type.
 * @param {string} type
 * @returns {"badge-technical"|"badge-user"}
 */
function getBadgeClass(type) {
  return isTechnicalType(type) ? "badge-technical" : "badge-user";
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#BASE_URL">BASE_URL</a></li><li><a href="global.html#activeHighlightColumnId">activeHighlightColumnId</a></li><li><a href="global.html#addActiveClassToSidebarButtons">addActiveClassToSidebarButtons</a></li><li><a href="global.html#addNewContact">addNewContact</a></li><li><a href="global.html#afterRender">afterRender</a></li><li><a href="global.html#applyStatusChangeForDraggedTask">applyStatusChangeForDraggedTask</a></li><li><a href="global.html#assignedToDataExtractSafe">assignedToDataExtractSafe</a></li><li><a href="global.html#autoMoveTimeoutId">autoMoveTimeoutId</a></li><li><a href="global.html#bigCardDynamicHtml">bigCardDynamicHtml</a></li><li><a href="global.html#bigCardDynamicTechnicalHtml">bigCardDynamicTechnicalHtml</a></li><li><a href="global.html#bigCardHtml">bigCardHtml</a></li><li><a href="global.html#buildSubtaskListItem">buildSubtaskListItem</a></li><li><a href="global.html#callWhiteScreen">callWhiteScreen</a></li><li><a href="global.html#canDeleteTask">canDeleteTask</a></li><li><a href="global.html#cancelScheduledAutoMove">cancelScheduledAutoMove</a></li><li><a href="global.html#checkIfBlockIsFilled">checkIfBlockIsFilled</a></li><li><a href="global.html#checkLogin">checkLogin</a></li><li><a href="global.html#checkPolicyandAnswers">checkPolicyandAnswers</a></li><li><a href="global.html#clearAddTaskAfterAnimation">clearAddTaskAfterAnimation</a></li><li><a href="global.html#clearAllColumnHighlights">clearAllColumnHighlights</a></li><li><a href="global.html#closeAddTask">closeAddTask</a></li><li><a href="global.html#closeModal">closeModal</a></li><li><a href="global.html#closeTaskModal">closeTaskModal</a></li><li><a href="global.html#closeWhiteScreen">closeWhiteScreen</a></li><li><a href="global.html#collectTaskFromForm">collectTaskFromForm</a></li><li><a href="global.html#contactBlock">contactBlock</a></li><li><a href="global.html#createTask">createTask</a></li><li><a href="global.html#currentDragCardEl">currentDragCardEl</a></li><li><a href="global.html#currentlySelectedContact">currentlySelectedContact</a></li><li><a href="global.html#deleteContact">deleteContact</a></li><li><a href="global.html#deleteContactinEditContactWindow">deleteContactinEditContactWindow</a></li><li><a href="global.html#deleteDynamicTask">deleteDynamicTask</a></li><li><a href="global.html#deleteIdFromLocalStorage">deleteIdFromLocalStorage</a></li><li><a href="global.html#deleteTaskFromArray">deleteTaskFromArray</a></li><li><a href="global.html#deleteTaskOnServer">deleteTaskOnServer</a></li><li><a href="global.html#demoTasks">demoTasks</a></li><li><a href="global.html#editContact">editContact</a></li><li><a href="global.html#emptyTheAddContactFormular">emptyTheAddContactFormular</a></li><li><a href="global.html#ensureAddTaskCss">ensureAddTaskCss</a></li><li><a href="global.html#ensureBoardAuth">ensureBoardAuth</a></li><li><a href="global.html#ensureCssForLegacy">ensureCssForLegacy</a></li><li><a href="global.html#ensureTechnicalCss">ensureTechnicalCss</a></li><li><a href="global.html#ensureToastRoot">ensureToastRoot</a></li><li><a href="global.html#ensureUserStoryCss">ensureUserStoryCss</a></li><li><a href="global.html#fallbackModal">fallbackModal</a></li><li><a href="global.html#fetchBoardTasks">fetchBoardTasks</a></li><li><a href="global.html#findColumnByPointer">findColumnByPointer</a></li><li><a href="global.html#findIndexFromUsername">findIndexFromUsername</a></li><li><a href="global.html#findTaskById">findTaskById</a></li><li><a href="global.html#findTaskForModal">findTaskForModal</a></li><li><a href="global.html#generateTaskId">generateTaskId</a></li><li><a href="global.html#getAddTaskHtml">getAddTaskHtml</a></li><li><a href="global.html#getAddTaskTemplate">getAddTaskTemplate</a></li><li><a href="global.html#getBadgeClass">getBadgeClass</a></li><li><a href="global.html#getBasePath">getBasePath</a></li><li><a href="global.html#getBigCardDynamicHtml">getBigCardDynamicHtml</a></li><li><a href="global.html#getBigCardDynamicTechnicalHtml">getBigCardDynamicTechnicalHtml</a></li><li><a href="global.html#getBoardAuthQuery">getBoardAuthQuery</a></li><li><a href="global.html#getContactColorType">getContactColorType</a></li><li><a href="global.html#getCurrentUidOrThrow">getCurrentUidOrThrow</a></li><li><a href="global.html#getDraggedTask">getDraggedTask</a></li><li><a href="global.html#getFriendsForCurrentUser">getFriendsForCurrentUser</a></li><li><a href="global.html#getInitials">getInitials</a></li><li><a href="global.html#getInitialsFromName">getInitialsFromName</a></li><li><a href="global.html#getLegacyTaskHtml">getLegacyTaskHtml</a></li><li><a href="global.html#getNextDeadline">getNextDeadline</a></li><li><a href="global.html#getRandomInt">getRandomInt</a></li><li><a href="global.html#getSignupValues">getSignupValues</a></li><li><a href="global.html#getSubtasksSafe">getSubtasksSafe</a></li><li><a href="global.html#getSummaryFetchConfig">getSummaryFetchConfig</a></li><li><a href="global.html#getTaskCounts">getTaskCounts</a></li><li><a href="global.html#getTaskForDelete">getTaskForDelete</a></li><li><a href="global.html#getTaskModalElements">getTaskModalElements</a></li><li><a href="global.html#getTechnicalTaskTemplate">getTechnicalTaskTemplate</a></li><li><a href="global.html#getUserFriendslistByUid">getUserFriendslistByUid</a></li><li><a href="global.html#getValidationState">getValidationState</a></li><li><a href="global.html#getWhiteScreen">getWhiteScreen</a></li><li><a href="global.html#greetUserName">greetUserName</a></li><li><a href="global.html#handleAddContact">handleAddContact</a></li><li><a href="global.html#handleContactClick">handleContactClick</a></li><li><a href="global.html#hideAddContactFormular">hideAddContactFormular</a></li><li><a href="global.html#hideEditContactFormular">hideEditContactFormular</a></li><li><a href="global.html#hideToastLater">hideToastLater</a></li><li><a href="global.html#hydrateAssignSection">hydrateAssignSection</a></li><li><a href="global.html#isDemoTask">isDemoTask</a></li><li><a href="global.html#isPublicPage">isPublicPage</a></li><li><a href="global.html#isTechnicalType">isTechnicalType</a></li><li><a href="global.html#isUserStoryType">isUserStoryType</a></li><li><a href="global.html#isValidName">isValidName</a></li><li><a href="global.html#jumpToLogin">jumpToLogin</a></li><li><a href="global.html#lastDragPointerX">lastDragPointerX</a></li><li><a href="global.html#loadTasks">loadTasks</a></li><li><a href="global.html#loadTasksFromFirebase">loadTasksFromFirebase</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#makeFirstLetterBig">makeFirstLetterBig</a></li><li><a href="global.html#mapCategoryToType">mapCategoryToType</a></li><li><a href="global.html#matchesSearch">matchesSearch</a></li><li><a href="global.html#nameOfTheCard">nameOfTheCard</a></li><li><a href="global.html#needsDraggingClassAfterRender">needsDraggingClassAfterRender</a></li><li><a href="global.html#normaliseSubtaskProgress">normaliseSubtaskProgress</a></li><li><a href="global.html#normalizeTaskType">normalizeTaskType</a></li><li><a href="global.html#onclickFunction">onclickFunction</a></li><li><a href="global.html#onloadFunctionHeader">onloadFunctionHeader</a></li><li><a href="global.html#openAddTask">openAddTask</a></li><li><a href="global.html#openDynamicTaskModal">openDynamicTaskModal</a></li><li><a href="global.html#openEditOverlay">openEditOverlay</a></li><li><a href="global.html#openLegacyTaskModal">openLegacyTaskModal</a></li><li><a href="global.html#openModalById">openModalById</a></li><li><a href="global.html#openModalDynamic">openModalDynamic</a></li><li><a href="global.html#openTaskModalWithTask">openTaskModalWithTask</a></li><li><a href="global.html#parseDueDate">parseDueDate</a></li><li><a href="global.html#pendingAutoMoveStatus">pendingAutoMoveStatus</a></li><li><a href="global.html#pendingDragTiltClass">pendingDragTiltClass</a></li><li><a href="global.html#persistContacts">persistContacts</a></li><li><a href="global.html#persistTasks">persistTasks</a></li><li><a href="global.html#pollSummary">pollSummary</a></li><li><a href="global.html#prepareEditState">prepareEditState</a></li><li><a href="global.html#prevOnload">prevOnload</a></li><li><a href="global.html#priorit%25C3%25A4tIcon">prioritätIcon</a></li><li><a href="global.html#pushExampleContactsOneTimeInLocalStorage">pushExampleContactsOneTimeInLocalStorage</a></li><li><a href="global.html#putUsernameInContactList">putUsernameInContactList</a></li><li><a href="global.html#removeContentfromAllContactBlocks">removeContentfromAllContactBlocks</a></li><li><a href="global.html#removeTaskCard">removeTaskCard</a></li><li><a href="global.html#render">render</a></li><li><a href="global.html#renderAddContact">renderAddContact</a></li><li><a href="global.html#renderCard">renderCard</a></li><li><a href="global.html#renderContactList">renderContactList</a></li><li><a href="global.html#renderEditContact">renderEditContact</a></li><li><a href="global.html#renderModalContent">renderModalContent</a></li><li><a href="global.html#renderSingleContact">renderSingleContact</a></li><li><a href="global.html#renderUserMenuePopupMenu">renderUserMenuePopupMenu</a></li><li><a href="global.html#requestBoardRender">requestBoardRender</a></li><li><a href="global.html#resetAddTaskGlobals">resetAddTaskGlobals</a></li><li><a href="global.html#resetError">resetError</a></li><li><a href="global.html#restoreSubtasksState">restoreSubtasksState</a></li><li><a href="global.html#saveTaskEdits">saveTaskEdits</a></li><li><a href="global.html#scheduleAutoMoveTo">scheduleAutoMoveTo</a></li><li><a href="global.html#searchQuery">searchQuery</a></li><li><a href="global.html#seedDemoFriendsIfEmpty">seedDemoFriendsIfEmpty</a></li><li><a href="global.html#setActiveSidebarByURL">setActiveSidebarByURL</a></li><li><a href="global.html#setContactsIntoContactblock">setContactsIntoContactblock</a></li><li><a href="global.html#setLetterInUserBall">setLetterInUserBall</a></li><li><a href="global.html#setSummaryText">setSummaryText</a></li><li><a href="global.html#setUserDataValue">setUserDataValue</a></li><li><a href="global.html#setupAddTaskContent">setupAddTaskContent</a></li><li><a href="global.html#showAddContactFormular">showAddContactFormular</a></li><li><a href="global.html#showContactToast">showContactToast</a></li><li><a href="global.html#showEditContactFormular">showEditContactFormular</a></li><li><a href="global.html#showError">showError</a></li><li><a href="global.html#showTaskModal">showTaskModal</a></li><li><a href="global.html#showToast">showToast</a></li><li><a href="global.html#singleContactTemplate">singleContactTemplate</a></li><li><a href="global.html#sortUserToAlphabeticalOrder">sortUserToAlphabeticalOrder</a></li><li><a href="global.html#startEditTask">startEditTask</a></li><li><a href="global.html#startSummaryPolling">startSummaryPolling</a></li><li><a href="global.html#statusByColumnId">statusByColumnId</a></li><li><a href="global.html#toggleContactHighlight">toggleContactHighlight</a></li><li><a href="global.html#toggleUserMenuePopupMenu">toggleUserMenuePopupMenu</a></li><li><a href="global.html#updateButtonState">updateButtonState</a></li><li><a href="global.html#updateErrorForSignup">updateErrorForSignup</a></li><li><a href="global.html#updateFriendsForCurrentUser">updateFriendsForCurrentUser</a></li><li><a href="global.html#updateSearchClearButtonState">updateSearchClearButtonState</a></li><li><a href="global.html#updateSummary">updateSummary</a></li><li><a href="global.html#updateTimeout">updateTimeout</a></li><li><a href="global.html#updateUserFriendslistByUid">updateUserFriendslistByUid</a></li><li><a href="global.html#updateUserMenuPosition">updateUserMenuPosition</a></li><li><a href="global.html#userMenuTemplate">userMenuTemplate</a></li><li><a href="global.html#validateEmailInForm">validateEmailInForm</a></li><li><a href="global.html#validateEmailOnSubmit">validateEmailOnSubmit</a></li><li><a href="global.html#validateNameAndPasswordOnSubmit">validateNameAndPasswordOnSubmit</a></li><li><a href="global.html#whichCardActuellDrop">whichCardActuellDrop</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Wed Dec 10 2025 16:29:03 GMT+0100 (Mitteleuropäische Normalzeit)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
