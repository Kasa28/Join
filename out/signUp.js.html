<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: signUp.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: signUp.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {
  createUserWithEmailAndPassword,
  updateProfile,
  signOut,
} from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";

/**
 * Firebase Realtime Database base URL.
 * @type {string}
 */
const BASE_URL =
  "https://join-a3ae3-default-rtdb.europe-west1.firebasedatabase.app/";

/**
 * @param {string} name
 * @returns {boolean}
 */
function isValidName(name) {
  const trimmed = name.trim();
  return trimmed.length >= 2 &amp;&amp; /^[\p{L}\p{M}\s'.-]+$/u.test(trimmed);
}

function isValidEmail(email) {
  if (!email) return false;
  const [local, domain] = String(email).trim().split("@");
  if (!local || !domain) return false;
  if (local.startsWith(".") || local.endsWith(".") || local.includes("..")) return false;
  if (!/^[A-Za-z0-9._%+-]+$/.test(local) || !/[A-Za-z]/.test(local)) return false;
  if (!/^[A-Za-z0-9.-]+$/.test(domain)) return false;
  const parts = domain.split(".");
  if (parts.length &lt; 2 || parts.some((p) => !p || p.startsWith("-") || p.endsWith("-"))) return false;
  const tld = parts[parts.length - 1], mainDomain = parts[parts.length - 2];
  if (!/^[A-Za-z]{2,}$/.test(tld) || !/[A-Za-z]/.test(mainDomain)) return false;
  return true;
}


async function writeUserProfile(uid, name, email, idToken) {
  const url = `${BASE_URL}users/${uid}/profile.json?auth=${encodeURIComponent(
    idToken
  )}`;
  const res = await fetch(url, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ name, email, createdAt: Date.now() }),
  });
}

/**
 * Handles signup form submit:
 * validates inputs, creates user, shows toast, and redirects to login.
 * @param {Event} [event]
 * @param {Event} [event] - Optional submit event to prevent default behavior.
 * @returns {void}
 */
async function onclickFunction(event) {
  if (event) {
    event.preventDefault();
  }
  const name = document.getElementById("name").value.trim();
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();
  const errorEl = document.getElementById("error_message");
  if (!validateEmailOnSubmit(email, errorEl)) return;
  if (!validateNameAndPasswordOnSubmit(name, password, errorEl)) return;
  resetError(errorEl);
  try {
    if (window.authReady) await window.authReady;

    const cred = await createUserWithEmailAndPassword(
      window.auth,
      email,
      password
    );

    await updateProfile(cred.user, { displayName: name });

    const idToken = await cred.user.getIdToken();
    await writeUserProfile(cred.user.uid, name, email, idToken);
    await signOut(window.auth);

    showToast("You signed up successfully", { duration: 1000, dim: true });
    setTimeout(jumpToLogin, 1200);
  } catch (err) {
    showError(errorEl, mapAuthError(err));
  }
}

/**
 * Validates email on submit and shows an error if needed.
 * @param {string} email
 * @param {HTMLElement} errorEl
 * @returns {boolean}
 */
function validateEmailOnSubmit(email, errorEl) {
  if (isValidEmail(email)) {
    return true;
  }
  showError(errorEl, "Please enter a valid email address!");
  return false;
}

/**
 * Validates name and password on submit and shows an error if needed.
 * @param {string} name
 * @param {string} password
 * @param {HTMLElement} errorEl
 * @returns {boolean}
 */
function validateNameAndPasswordOnSubmit(name, password, errorEl) {
  if (isValidName(name) &amp;&amp; password) {
    return true;
  }
  showError(errorEl, "Please enter a valid name.");
  return false;
}

/**
 * Redirects to login page.
 * @returns {void}
 */
function jumpToLogin() {
  window.location.href = "./index.html";
}

/**
 * Shows the white-screen overlay.
 * @returns {void}
 */
function getWhiteScreen() {
  const contentRef = document.getElementById("white-screen");
  contentRef.classList.remove("d_none");
}

/**
 * Validates form fields + policy checkbox and enables/disables submit button.
 * Shows inline error messages if invalid.
 * @returns {void}
 */
function checkPolicyandAnswers() {
  const values = getSignupValues();
  const state = getValidationState(values);
  updateErrorForSignup(values, state);
  updateButtonState(values, state);
}

/**
 * Collects all signup form values and related elements.
 * @returns {{name:string,email:string,password:string,confirmPassword:string,checkbox:HTMLElement,button:HTMLButtonElement,errorEl:HTMLElement}}
 */
function getSignupValues() {
  const name = document.getElementById("name").value.trim();
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();
  const confirmPassword = document
    .getElementById("confirm_password")
    .value.trim();
  const checkbox = document.getElementById("accept_terms");
  const button = document.querySelector(".primary_button");
  const errorEl = document.getElementById("error_message");
  return { name, email, password, confirmPassword, checkbox, button, errorEl };
}

/**
 * Calculates validation flags for the current form values.
 * @param {ReturnType&lt;typeof getSignupValues>} values
 * @returns {{passwordSame:boolean,emailValid:boolean,nameValid:boolean}}
 */
function getValidationState(values) {
  const passwordSame = values.password === values.confirmPassword;
  const emailValid = isValidEmail(values.email);
  const nameValid = isValidName(values.name);
  return { passwordSame, emailValid, nameValid };
}

/**
 * Updates the inline error message depending on invalid field.
 * @param {ReturnType&lt;typeof getSignupValues>} values
 * @param {{passwordSame:boolean,emailValid:boolean,nameValid:boolean}} state
 * @returns {void}
 */
function updateErrorForSignup(values, state) {
  const errorEl = values.errorEl;
  if (!state.emailValid &amp;&amp; values.email.length > 0) {
    showError(errorEl, "Please enter a valid email address!");
  } else if (values.name.length > 0 &amp;&amp; !state.nameValid) {
    showError(errorEl, "Please enter a valid name with at least 3 letters!");
  } else if (
    values.password.length > 0 &amp;&amp;
    values.confirmPassword.length > 0 &amp;&amp;
    !state.passwordSame
  ) {
    showError(errorEl, "The passwords do not match!");
  } else {
    resetError(errorEl);
  }
}

/**
 * Enables/disables the submit button based on validation state.
 * @param {ReturnType&lt;typeof getSignupValues>} values
 * @param {{passwordSame:boolean,emailValid:boolean,nameValid:boolean}} state
 * @returns {void}
 */
function updateButtonState(values, state) {
  const allFilled =
    values.name &amp;&amp;
    values.email &amp;&amp;
    values.password &amp;&amp;
    values.confirmPassword &amp;&amp;
    values.checkbox.checked;
  const enabled =
    allFilled &amp;&amp; state.passwordSame &amp;&amp; state.emailValid &amp;&amp; state.nameValid;
  values.button.disabled = !enabled;
}

/**
 * Shows an error message element in red.
 * @param {HTMLElement} errorEl
 * @param {string} text
 * @returns {void}
 */
function showError(errorEl, text) {
  errorEl.textContent = text;
  errorEl.classList.remove("visually-hidden");
  errorEl.style.color = "red";
}

/**
 * Resets the error message element.
 * @param {HTMLElement} errorEl
 * @returns {void}
 */
function resetError(errorEl) {
  errorEl.textContent = "";
  errorEl.classList.add("visually-hidden");
}

/**
 * @typedef {Object} ToastOptions
 * @property {number} [duration=3000]
 * @property {boolean} [dim=true]
 */

/**
 * Shows a toast message. Optionally dims background while visible.
 * Kein addEventListener, nur onanimationend.
 * @param {string} text
 * @param {ToastOptions} [options]
 * @returns {void}
 */
function showToast(text, options) {
  if (!options) {
    options = {};
  }
  const duration = options.duration || 3000;
  const dim = options.dim === undefined ? true : options.dim;
  const root = ensureToastRoot();
  const el = document.createElement("div");
  el.className = "toast toast--show";
  el.innerHTML = "&lt;span>" + text + "&lt;/span>";
  root.appendChild(el);
  const dimEl = document.getElementById("toast-dim");
  if (dim &amp;&amp; dimEl) {
    dimEl.classList.add("dim--show");
  }
  hideToastLater(el, dimEl, dim, duration);
}

/**
 * Makes sure the toast root element exists.
 * @returns {HTMLElement}
 */
function ensureToastRoot() {
  let root = document.getElementById("toast-root");
  if (!root) {
    root = document.createElement("div");
    root.id = "toast-root";
    document.body.appendChild(root);
  }
  return root;
}

/**
 * Hides the toast after a delay.
 * Uses onanimationend instead of addEventListener.
 * @param {HTMLElement} el
 * @param {HTMLElement|null} dimEl
 * @param {boolean} dim
 * @param {number} duration
 * @returns {void}
 */
function hideToastLater(el, dimEl, dim, duration) {
  setTimeout(function () {
    el.classList.remove("toast--show");
    el.classList.add("toast--hide");
    el.onanimationend = function () {
      el.remove();
    };
    if (dim &amp;&amp; dimEl) {
      dimEl.classList.remove("dim--show");
    }
  }, duration);
}

/**
 * Exposes showToast globally.
 * @type {(text: string, options?: ToastOptions) => void}
 */
window.showToast = showToast;

function mapAuthError(err) {
  const code = err?.code || "";
  if (code.includes("auth/email-already-in-use"))
    return "This email is already registered.";
  if (code.includes("auth/invalid-email"))
    return "Please enter a valid email address!";
  if (code.includes("auth/weak-password"))
    return "Password is too weak (at least 6 characters).";
  if (code.includes("auth/operation-not-allowed"))
    return "Email/password sign-in is not enabled in Firebase.";
  return "Signup failed. Please try again.";
}

window.onclickFunction = onclickFunction;
window.checkPolicyandAnswers = checkPolicyandAnswers;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#BASE_URL">BASE_URL</a></li><li><a href="global.html#activeHighlightColumnId">activeHighlightColumnId</a></li><li><a href="global.html#addActiveClassToSidebarButtons">addActiveClassToSidebarButtons</a></li><li><a href="global.html#addNewContact">addNewContact</a></li><li><a href="global.html#afterRender">afterRender</a></li><li><a href="global.html#applyStatusChangeForDraggedTask">applyStatusChangeForDraggedTask</a></li><li><a href="global.html#assignedToDataExtractSafe">assignedToDataExtractSafe</a></li><li><a href="global.html#autoMoveTimeoutId">autoMoveTimeoutId</a></li><li><a href="global.html#bigCardDynamicHtml">bigCardDynamicHtml</a></li><li><a href="global.html#bigCardDynamicTechnicalHtml">bigCardDynamicTechnicalHtml</a></li><li><a href="global.html#bigCardHtml">bigCardHtml</a></li><li><a href="global.html#buildSubtaskListItem">buildSubtaskListItem</a></li><li><a href="global.html#callWhiteScreen">callWhiteScreen</a></li><li><a href="global.html#canDeleteTask">canDeleteTask</a></li><li><a href="global.html#cancelScheduledAutoMove">cancelScheduledAutoMove</a></li><li><a href="global.html#checkIfBlockIsFilled">checkIfBlockIsFilled</a></li><li><a href="global.html#checkLogin">checkLogin</a></li><li><a href="global.html#checkPolicyandAnswers">checkPolicyandAnswers</a></li><li><a href="global.html#clearAddTaskAfterAnimation">clearAddTaskAfterAnimation</a></li><li><a href="global.html#clearAllColumnHighlights">clearAllColumnHighlights</a></li><li><a href="global.html#closeAddTask">closeAddTask</a></li><li><a href="global.html#closeModal">closeModal</a></li><li><a href="global.html#closeTaskModal">closeTaskModal</a></li><li><a href="global.html#closeWhiteScreen">closeWhiteScreen</a></li><li><a href="global.html#collectTaskFromForm">collectTaskFromForm</a></li><li><a href="global.html#contactBlock">contactBlock</a></li><li><a href="global.html#createTask">createTask</a></li><li><a href="global.html#currentDragCardEl">currentDragCardEl</a></li><li><a href="global.html#currentlySelectedContact">currentlySelectedContact</a></li><li><a href="global.html#deleteContact">deleteContact</a></li><li><a href="global.html#deleteContactinEditContactWindow">deleteContactinEditContactWindow</a></li><li><a href="global.html#deleteDynamicTask">deleteDynamicTask</a></li><li><a href="global.html#deleteIdFromLocalStorage">deleteIdFromLocalStorage</a></li><li><a href="global.html#deleteTaskFromArray">deleteTaskFromArray</a></li><li><a href="global.html#deleteTaskOnServer">deleteTaskOnServer</a></li><li><a href="global.html#demoTasks">demoTasks</a></li><li><a href="global.html#editContact">editContact</a></li><li><a href="global.html#emptyTheAddContactFormular">emptyTheAddContactFormular</a></li><li><a href="global.html#ensureAddTaskCss">ensureAddTaskCss</a></li><li><a href="global.html#ensureBoardAuth">ensureBoardAuth</a></li><li><a href="global.html#ensureCssForLegacy">ensureCssForLegacy</a></li><li><a href="global.html#ensureTechnicalCss">ensureTechnicalCss</a></li><li><a href="global.html#ensureToastRoot">ensureToastRoot</a></li><li><a href="global.html#ensureUserStoryCss">ensureUserStoryCss</a></li><li><a href="global.html#fallbackModal">fallbackModal</a></li><li><a href="global.html#fetchBoardTasks">fetchBoardTasks</a></li><li><a href="global.html#findColumnByPointer">findColumnByPointer</a></li><li><a href="global.html#findIndexFromUsername">findIndexFromUsername</a></li><li><a href="global.html#findTaskById">findTaskById</a></li><li><a href="global.html#findTaskForModal">findTaskForModal</a></li><li><a href="global.html#generateTaskId">generateTaskId</a></li><li><a href="global.html#getAddTaskHtml">getAddTaskHtml</a></li><li><a href="global.html#getAddTaskTemplate">getAddTaskTemplate</a></li><li><a href="global.html#getBadgeClass">getBadgeClass</a></li><li><a href="global.html#getBasePath">getBasePath</a></li><li><a href="global.html#getBigCardDynamicHtml">getBigCardDynamicHtml</a></li><li><a href="global.html#getBigCardDynamicTechnicalHtml">getBigCardDynamicTechnicalHtml</a></li><li><a href="global.html#getBoardAuthQuery">getBoardAuthQuery</a></li><li><a href="global.html#getContactColorType">getContactColorType</a></li><li><a href="global.html#getCurrentUidOrThrow">getCurrentUidOrThrow</a></li><li><a href="global.html#getDraggedTask">getDraggedTask</a></li><li><a href="global.html#getFriendsForCurrentUser">getFriendsForCurrentUser</a></li><li><a href="global.html#getInitials">getInitials</a></li><li><a href="global.html#getInitialsFromName">getInitialsFromName</a></li><li><a href="global.html#getLegacyTaskHtml">getLegacyTaskHtml</a></li><li><a href="global.html#getNextDeadline">getNextDeadline</a></li><li><a href="global.html#getRandomInt">getRandomInt</a></li><li><a href="global.html#getSignupValues">getSignupValues</a></li><li><a href="global.html#getSubtasksSafe">getSubtasksSafe</a></li><li><a href="global.html#getSummaryFetchConfig">getSummaryFetchConfig</a></li><li><a href="global.html#getTaskCounts">getTaskCounts</a></li><li><a href="global.html#getTaskForDelete">getTaskForDelete</a></li><li><a href="global.html#getTaskModalElements">getTaskModalElements</a></li><li><a href="global.html#getTechnicalTaskTemplate">getTechnicalTaskTemplate</a></li><li><a href="global.html#getUserFriendslistByUid">getUserFriendslistByUid</a></li><li><a href="global.html#getValidationState">getValidationState</a></li><li><a href="global.html#getWhiteScreen">getWhiteScreen</a></li><li><a href="global.html#greetUserName">greetUserName</a></li><li><a href="global.html#handleAddContact">handleAddContact</a></li><li><a href="global.html#handleContactClick">handleContactClick</a></li><li><a href="global.html#hideAddContactFormular">hideAddContactFormular</a></li><li><a href="global.html#hideEditContactFormular">hideEditContactFormular</a></li><li><a href="global.html#hideToastLater">hideToastLater</a></li><li><a href="global.html#hydrateAssignSection">hydrateAssignSection</a></li><li><a href="global.html#isDemoTask">isDemoTask</a></li><li><a href="global.html#isPublicPage">isPublicPage</a></li><li><a href="global.html#isTechnicalType">isTechnicalType</a></li><li><a href="global.html#isUserStoryType">isUserStoryType</a></li><li><a href="global.html#isValidName">isValidName</a></li><li><a href="global.html#jumpToLogin">jumpToLogin</a></li><li><a href="global.html#lastDragPointerX">lastDragPointerX</a></li><li><a href="global.html#loadTasks">loadTasks</a></li><li><a href="global.html#loadTasksFromFirebase">loadTasksFromFirebase</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#makeFirstLetterBig">makeFirstLetterBig</a></li><li><a href="global.html#mapCategoryToType">mapCategoryToType</a></li><li><a href="global.html#matchesSearch">matchesSearch</a></li><li><a href="global.html#nameOfTheCard">nameOfTheCard</a></li><li><a href="global.html#needsDraggingClassAfterRender">needsDraggingClassAfterRender</a></li><li><a href="global.html#normaliseSubtaskProgress">normaliseSubtaskProgress</a></li><li><a href="global.html#normalizeTaskType">normalizeTaskType</a></li><li><a href="global.html#onclickFunction">onclickFunction</a></li><li><a href="global.html#onloadFunctionHeader">onloadFunctionHeader</a></li><li><a href="global.html#openAddTask">openAddTask</a></li><li><a href="global.html#openDynamicTaskModal">openDynamicTaskModal</a></li><li><a href="global.html#openEditOverlay">openEditOverlay</a></li><li><a href="global.html#openLegacyTaskModal">openLegacyTaskModal</a></li><li><a href="global.html#openModalById">openModalById</a></li><li><a href="global.html#openModalDynamic">openModalDynamic</a></li><li><a href="global.html#openTaskModalWithTask">openTaskModalWithTask</a></li><li><a href="global.html#parseDueDate">parseDueDate</a></li><li><a href="global.html#pendingAutoMoveStatus">pendingAutoMoveStatus</a></li><li><a href="global.html#pendingDragTiltClass">pendingDragTiltClass</a></li><li><a href="global.html#persistContacts">persistContacts</a></li><li><a href="global.html#persistTasks">persistTasks</a></li><li><a href="global.html#pollSummary">pollSummary</a></li><li><a href="global.html#prepareEditState">prepareEditState</a></li><li><a href="global.html#prevOnload">prevOnload</a></li><li><a href="global.html#priorit%25C3%25A4tIcon">prioritätIcon</a></li><li><a href="global.html#pushExampleContactsOneTimeInLocalStorage">pushExampleContactsOneTimeInLocalStorage</a></li><li><a href="global.html#putUsernameInContactList">putUsernameInContactList</a></li><li><a href="global.html#removeContentfromAllContactBlocks">removeContentfromAllContactBlocks</a></li><li><a href="global.html#removeTaskCard">removeTaskCard</a></li><li><a href="global.html#render">render</a></li><li><a href="global.html#renderAddContact">renderAddContact</a></li><li><a href="global.html#renderCard">renderCard</a></li><li><a href="global.html#renderContactList">renderContactList</a></li><li><a href="global.html#renderEditContact">renderEditContact</a></li><li><a href="global.html#renderModalContent">renderModalContent</a></li><li><a href="global.html#renderSingleContact">renderSingleContact</a></li><li><a href="global.html#renderUserMenuePopupMenu">renderUserMenuePopupMenu</a></li><li><a href="global.html#requestBoardRender">requestBoardRender</a></li><li><a href="global.html#resetAddTaskGlobals">resetAddTaskGlobals</a></li><li><a href="global.html#resetError">resetError</a></li><li><a href="global.html#restoreSubtasksState">restoreSubtasksState</a></li><li><a href="global.html#saveTaskEdits">saveTaskEdits</a></li><li><a href="global.html#scheduleAutoMoveTo">scheduleAutoMoveTo</a></li><li><a href="global.html#searchQuery">searchQuery</a></li><li><a href="global.html#seedDemoFriendsIfEmpty">seedDemoFriendsIfEmpty</a></li><li><a href="global.html#setActiveSidebarByURL">setActiveSidebarByURL</a></li><li><a href="global.html#setContactsIntoContactblock">setContactsIntoContactblock</a></li><li><a href="global.html#setLetterInUserBall">setLetterInUserBall</a></li><li><a href="global.html#setSummaryText">setSummaryText</a></li><li><a href="global.html#setUserDataValue">setUserDataValue</a></li><li><a href="global.html#setupAddTaskContent">setupAddTaskContent</a></li><li><a href="global.html#showAddContactFormular">showAddContactFormular</a></li><li><a href="global.html#showContactToast">showContactToast</a></li><li><a href="global.html#showEditContactFormular">showEditContactFormular</a></li><li><a href="global.html#showError">showError</a></li><li><a href="global.html#showTaskModal">showTaskModal</a></li><li><a href="global.html#showToast">showToast</a></li><li><a href="global.html#singleContactTemplate">singleContactTemplate</a></li><li><a href="global.html#sortUserToAlphabeticalOrder">sortUserToAlphabeticalOrder</a></li><li><a href="global.html#startEditTask">startEditTask</a></li><li><a href="global.html#startSummaryPolling">startSummaryPolling</a></li><li><a href="global.html#statusByColumnId">statusByColumnId</a></li><li><a href="global.html#toggleContactHighlight">toggleContactHighlight</a></li><li><a href="global.html#toggleUserMenuePopupMenu">toggleUserMenuePopupMenu</a></li><li><a href="global.html#updateButtonState">updateButtonState</a></li><li><a href="global.html#updateErrorForSignup">updateErrorForSignup</a></li><li><a href="global.html#updateFriendsForCurrentUser">updateFriendsForCurrentUser</a></li><li><a href="global.html#updateSearchClearButtonState">updateSearchClearButtonState</a></li><li><a href="global.html#updateSummary">updateSummary</a></li><li><a href="global.html#updateTimeout">updateTimeout</a></li><li><a href="global.html#updateUserFriendslistByUid">updateUserFriendslistByUid</a></li><li><a href="global.html#updateUserMenuPosition">updateUserMenuPosition</a></li><li><a href="global.html#userMenuTemplate">userMenuTemplate</a></li><li><a href="global.html#validateEmailInForm">validateEmailInForm</a></li><li><a href="global.html#validateEmailOnSubmit">validateEmailOnSubmit</a></li><li><a href="global.html#validateNameAndPasswordOnSubmit">validateNameAndPasswordOnSubmit</a></li><li><a href="global.html#whichCardActuellDrop">whichCardActuellDrop</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Wed Dec 10 2025 16:29:03 GMT+0100 (Mitteleuropäische Normalzeit)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
