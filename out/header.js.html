<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: header.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: header.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* === header.js | Handles user menu, login state, and header rendering === */

/**
 * Determines the correct base path for links depending on the current page location.
 * Returns `".."` if the current page is inside a nested folder (e.g., /board_code/ or /addTask_code/),
 * otherwise returns `"."` for root-level pages.
 *
 * @returns {string} The relative base path to use for link generation.
 */
function getBasePath() {
  const path = window.location.pathname;
  if (path.includes("/board_code/") || path.includes("/addTask_code/")) {
    return "..";
  }
  return ".";
}

/**
 * Returns the HTML template for the user menu displayed in the header.
 * @returns {string} The user menu HTML string.
 */

function userMenuTemplate() {
  const base = getBasePath();
  return `&lt;div class="user-menu-container-header">
                &lt;div class="user-menu-content-header">
                    &lt;div>
                        &lt;a class="button-sidebar padding-up-down-small button_help" href="${base}/help.html">
                            &lt;span class="sidebar-font">Help&lt;/span>
                        &lt;/a>
                    &lt;/div>
                    &lt;div>
                        &lt;a class="button-sidebar padding-up-down-small" href="${base}/legal.html">
                            &lt;span class="sidebar-font">Legal Notice&lt;/span>
                        &lt;/a>
                    &lt;/div>
                    &lt;div>
                        &lt;a class="button-sidebar padding-up-down-small" href="${base}/privacy.html">
                            &lt;span class="sidebar-font">Privacy Policy&lt;/span>
                        &lt;/a>
                    &lt;/div>
                    &lt;div>
                        &lt;a onclick="deleteIdFromLocalStorage(), logout()" class="button-sidebar padding-up-down-small" href="${base}/index.html">
                            &lt;span class="sidebar-font">Logout&lt;/span>
                        &lt;/a>
                    &lt;/div>
                &lt;/div>
            &lt;/div>`;
}

/* === Render User Menu === */
/**
 * Renders the user menu popup into the header container.
 */
function renderUserMenuePopupMenu() {
  const contentRef = document.getElementById("user-menue-header");
  if (!contentRef) return;
  contentRef.innerHTML = userMenuTemplate();
}

/* === Toggle User Menu Visibility === */
/**
 * Toggles the visibility of the user menu popup in the header.
 */
function toggleUserMenuePopupMenu() {
  const contentRef = document.getElementById("user-menue-header");
  if (!contentRef) return;
  contentRef.classList.toggle("d_none");
  if (!contentRef.classList.contains("d_none")) {
    updateUserMenuPosition();
  }
}

/**
 * Positions the user menu directly beneath the avatar circle so it stays visually connected.
 */
function updateUserMenuPosition() {
  const wrapper = document.getElementById("user-menue-header");
  const menu = wrapper?.querySelector(".user-menu-container-header");
  const trigger = document.querySelector(".guest-logo-header");

  if (!wrapper || !menu || !trigger || wrapper.classList.contains("d_none")) {
    return;
  }

  const rect = trigger.getBoundingClientRect();
  const menuWidth =
    menu.offsetWidth || menu.getBoundingClientRect().width || 181;
  const calculatedLeft =
    rect.left + rect.width / 2 - menuWidth / 2 + window.scrollX;
  const minLeft = 8;

  menu.style.position = "fixed";
  menu.style.top = `${rect.bottom + 6 + window.scrollY}px`;
  menu.style.left = `${Math.max(minLeft, calculatedLeft)}px`;
  menu.style.right = "auto";
}

/* === Logout Functionality === */
/**
 * Signs out the current user and clears guest contacts from localStorage.
 */
async function deleteIdFromLocalStorage() {
  localStorage.removeItem(GUEST_CONTACTS_KEY);
  if (typeof window.signOut === "function") {
    await window.signOut();
  }
}

/* === Login State Check === */
/**
 * Checks whether a user is currently logged in by verifying stored user data.
 * Allows public access to help, legal, and privacy pages.
 * @returns {boolean} True if logged in, false otherwise.
 */
function isPublicPage() {
  const normalizedPath = window.location.pathname.toLowerCase();
  const publicPages = ["help", "legal", "privacy", "index", "/"];

  if (normalizedPath === "/") {
    return true;
  }
  return publicPages.some(
    (page) =>
      normalizedPath.endsWith(`${page}.html`) ||
      normalizedPath.endsWith(`/${page}`)
  );
}

function checkIfLogedIn() {
  const loggedIn = Boolean(window.currentUser);

  if (!loggedIn &amp;&amp; !isPublicPage() &amp;&amp; window.authReady) {
    window.authReady.then((user) => {
      if (!user) {
        const loginPath = "/index.html";
        window.location.href = loginPath;
      }
    });
  }
  return loggedIn;
}

/* === User Initial Display === */
/**
 * Initializes the header on page load by setting the user ball letter,
 * activating sidebar button behaviors, and highlighting the current page.
 */
async function onloadFunctionHeader() {
  if (window.authReady) await window.authReady;
  const isLoggedIn = checkIfLogedIn();
  toggleNavigationForGuest(isLoggedIn);
  const profile = isLoggedIn ? await loadCurrentUserProfile() : null;
  await setLetterInUserBall(isLoggedIn, profile);
  toggleNavigationForGuest(isLoggedIn);
  addActiveClassToSidebarButtons();
  setActiveSidebarByURL();
  document.body.classList.remove("preload");
}

/**
 * Sets the displayed initial in the user avatar circle based on login state.
 */
async function setLetterInUserBall(isLoggedIn, profile) {
  let contentRef = document.getElementById("user-ball-ID");
  if (!contentRef) return;
  if (!isLoggedIn) {
    contentRef.innerHTML = "G";
    return;
  }
  const isGuestUser = Boolean(
    window.currentUser?.isAnonymous || profile?.isGuest
  );
  const displayName =
    profile?.name ||
    window.currentUser?.displayName ||
    window.currentUser?.email ||
    (isGuestUser ? "Guest" : "");
  const userLetter = displayName.charAt(0).toUpperCase();
  if (userLetter) {
    contentRef.innerHTML = userLetter;
    return;
  }
  if (isGuestUser) {
    contentRef.innerHTML = "G";
    return;
  }
  contentRef.innerHTML = "?";
}

/* === Greeting Message Rendering === */
/**
 * Capitalizes the first letter of a given string.
 * @param {string} inputString - The string to modify.
 * @returns {string} The string with its first letter capitalized.
 */
function makeFirstLetterBig(inputString) {
  return (
    String(inputString).charAt(0).toUpperCase() + String(inputString).slice(1)
  );
}

/**
 * Renders a greeting message in the header, personalized when the user is logged in.
 */
async function greetUserName() {
  if (window.authReady) await window.authReady;
  let contentRef = document.getElementById("greetID");
  const now = new Date();
  const hour = now.getHours();
  let greeting = "";
  if (hour &lt; 12) {
    greeting = "Good Morning";
  } else if (hour &lt; 18) {
    greeting = "Good Afternoon";
  } else {
    greeting = "Good Evening";
  }
  if (!checkIfLogedIn()) {
    contentRef.innerHTML = `&lt;h1 class="summary-h1-font-guest">${greeting}&lt;/h1>`;
  } else {
    const profile = await loadCurrentUserProfile();
    const baseName =
      profile?.name ||
      window.currentUser?.displayName ||
      window.currentUser?.email ||
      "User";
    let userName = makeFirstLetterBig(baseName);
    contentRef.innerHTML = `&lt;h2 class="summary-h2-font-user">${greeting},&amp;nbsp;&lt;/h2>
                            &lt;h1 class="summary-h1-font-user">${userName}&lt;/h1>`;
  }
}

/**
 * Highlights the active sidebar button based on the current page URL.
 */
function setActiveSidebarByURL() {
  const currentPage = window.location.pathname.split("/").pop();
  document.querySelectorAll(".side-menu .button-sidebar").forEach((btn) => {
    const link = btn.getAttribute("href");
    btn.classList.remove("active");
    if (link &amp;&amp; link.includes(currentPage)) {
      btn.classList.add("active");
    }
  });
}

/**
 * Adds click listeners to sidebar buttons to visually indicate active selection.
 */
function addActiveClassToSidebarButtons() {
  document.querySelectorAll(".side-menu .button-sidebar").forEach((btn) => {
    btn.addEventListener("click", function () {
      document
        .querySelectorAll(".button-sidebar")
        .forEach((b) => b.classList.remove("active"));
      this.classList.add("active");
    });
  });
}
window.addEventListener("resize", updateUserMenuPosition);
function toggleNavigationForGuest(isLoggedIn) {
  const isPublic = isPublicPage();
  const isGuestOnPublic = !isLoggedIn &amp;&amp; isPublic;

  const sidebarHighSection = document.querySelector(
    ".sidebar-high-section-container"
  );
  const userAvatar = document.querySelector(".guest-logo-header");
  const loginLink = document.getElementById("guest-login-link");
  const headerHelpLink = document.getElementById("header-help-link");

  // Klasse für Layout (unten / oben verteilen usw.)
  document.body.classList.toggle("guest-mode", isGuestOnPublic);

  // === Sidebar oben (Summary, Add Task, Board, Contacts) ===
  // Nur zeigen, wenn User eingeloggt ODER keine öffentliche Seite
  if (sidebarHighSection) {
    sidebarHighSection.classList.toggle("d_none", isGuestOnPublic);
  }

  // === Avatar-Kreis oben rechts ===
  // Für Gäste auf öffentlichen Seiten ausblenden
  if (userAvatar) {
    userAvatar.classList.toggle("d_none", isGuestOnPublic);
  }

  // === Help-Icon (?) oben rechts ===
  // Für Gäste auf öffentlichen Seiten ausblenden
  if (headerHelpLink) {
    headerHelpLink.classList.toggle("d_none", isGuestOnPublic);
  }

  // === Login-Link in der Sidebar ===
  // Nur im Gast-Modus auf öffentlichen Seiten anzeigen
  if (loginLink) {
    loginLink.classList.toggle("d_none", !isGuestOnPublic);
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#BASE_URL">BASE_URL</a></li><li><a href="global.html#activeHighlightColumnId">activeHighlightColumnId</a></li><li><a href="global.html#addActiveClassToSidebarButtons">addActiveClassToSidebarButtons</a></li><li><a href="global.html#addNewContact">addNewContact</a></li><li><a href="global.html#afterRender">afterRender</a></li><li><a href="global.html#applyStatusChangeForDraggedTask">applyStatusChangeForDraggedTask</a></li><li><a href="global.html#assignedToDataExtractSafe">assignedToDataExtractSafe</a></li><li><a href="global.html#autoMoveTimeoutId">autoMoveTimeoutId</a></li><li><a href="global.html#bigCardDynamicHtml">bigCardDynamicHtml</a></li><li><a href="global.html#bigCardDynamicTechnicalHtml">bigCardDynamicTechnicalHtml</a></li><li><a href="global.html#bigCardHtml">bigCardHtml</a></li><li><a href="global.html#buildSubtaskListItem">buildSubtaskListItem</a></li><li><a href="global.html#callWhiteScreen">callWhiteScreen</a></li><li><a href="global.html#canDeleteTask">canDeleteTask</a></li><li><a href="global.html#cancelScheduledAutoMove">cancelScheduledAutoMove</a></li><li><a href="global.html#checkIfBlockIsFilled">checkIfBlockIsFilled</a></li><li><a href="global.html#checkLogin">checkLogin</a></li><li><a href="global.html#checkPolicyandAnswers">checkPolicyandAnswers</a></li><li><a href="global.html#clearAddTaskAfterAnimation">clearAddTaskAfterAnimation</a></li><li><a href="global.html#clearAllColumnHighlights">clearAllColumnHighlights</a></li><li><a href="global.html#closeAddTask">closeAddTask</a></li><li><a href="global.html#closeModal">closeModal</a></li><li><a href="global.html#closeTaskModal">closeTaskModal</a></li><li><a href="global.html#closeWhiteScreen">closeWhiteScreen</a></li><li><a href="global.html#collectTaskFromForm">collectTaskFromForm</a></li><li><a href="global.html#contactBlock">contactBlock</a></li><li><a href="global.html#createTask">createTask</a></li><li><a href="global.html#currentDragCardEl">currentDragCardEl</a></li><li><a href="global.html#currentlySelectedContact">currentlySelectedContact</a></li><li><a href="global.html#deleteContact">deleteContact</a></li><li><a href="global.html#deleteContactinEditContactWindow">deleteContactinEditContactWindow</a></li><li><a href="global.html#deleteDynamicTask">deleteDynamicTask</a></li><li><a href="global.html#deleteIdFromLocalStorage">deleteIdFromLocalStorage</a></li><li><a href="global.html#deleteTaskFromArray">deleteTaskFromArray</a></li><li><a href="global.html#deleteTaskOnServer">deleteTaskOnServer</a></li><li><a href="global.html#demoTasks">demoTasks</a></li><li><a href="global.html#editContact">editContact</a></li><li><a href="global.html#emptyTheAddContactFormular">emptyTheAddContactFormular</a></li><li><a href="global.html#ensureAddTaskCss">ensureAddTaskCss</a></li><li><a href="global.html#ensureBoardAuth">ensureBoardAuth</a></li><li><a href="global.html#ensureCssForLegacy">ensureCssForLegacy</a></li><li><a href="global.html#ensureTechnicalCss">ensureTechnicalCss</a></li><li><a href="global.html#ensureToastRoot">ensureToastRoot</a></li><li><a href="global.html#ensureUserStoryCss">ensureUserStoryCss</a></li><li><a href="global.html#fallbackModal">fallbackModal</a></li><li><a href="global.html#fetchBoardTasks">fetchBoardTasks</a></li><li><a href="global.html#findColumnByPointer">findColumnByPointer</a></li><li><a href="global.html#findIndexFromUsername">findIndexFromUsername</a></li><li><a href="global.html#findTaskById">findTaskById</a></li><li><a href="global.html#findTaskForModal">findTaskForModal</a></li><li><a href="global.html#generateTaskId">generateTaskId</a></li><li><a href="global.html#getAddTaskHtml">getAddTaskHtml</a></li><li><a href="global.html#getAddTaskTemplate">getAddTaskTemplate</a></li><li><a href="global.html#getBadgeClass">getBadgeClass</a></li><li><a href="global.html#getBasePath">getBasePath</a></li><li><a href="global.html#getBigCardDynamicHtml">getBigCardDynamicHtml</a></li><li><a href="global.html#getBigCardDynamicTechnicalHtml">getBigCardDynamicTechnicalHtml</a></li><li><a href="global.html#getBoardAuthQuery">getBoardAuthQuery</a></li><li><a href="global.html#getContactColorType">getContactColorType</a></li><li><a href="global.html#getCurrentUidOrThrow">getCurrentUidOrThrow</a></li><li><a href="global.html#getDraggedTask">getDraggedTask</a></li><li><a href="global.html#getFriendsForCurrentUser">getFriendsForCurrentUser</a></li><li><a href="global.html#getInitials">getInitials</a></li><li><a href="global.html#getInitialsFromName">getInitialsFromName</a></li><li><a href="global.html#getLegacyTaskHtml">getLegacyTaskHtml</a></li><li><a href="global.html#getNextDeadline">getNextDeadline</a></li><li><a href="global.html#getRandomInt">getRandomInt</a></li><li><a href="global.html#getSignupValues">getSignupValues</a></li><li><a href="global.html#getSubtasksSafe">getSubtasksSafe</a></li><li><a href="global.html#getSummaryFetchConfig">getSummaryFetchConfig</a></li><li><a href="global.html#getTaskCounts">getTaskCounts</a></li><li><a href="global.html#getTaskForDelete">getTaskForDelete</a></li><li><a href="global.html#getTaskModalElements">getTaskModalElements</a></li><li><a href="global.html#getTechnicalTaskTemplate">getTechnicalTaskTemplate</a></li><li><a href="global.html#getUserFriendslistByUid">getUserFriendslistByUid</a></li><li><a href="global.html#getValidationState">getValidationState</a></li><li><a href="global.html#getWhiteScreen">getWhiteScreen</a></li><li><a href="global.html#greetUserName">greetUserName</a></li><li><a href="global.html#handleAddContact">handleAddContact</a></li><li><a href="global.html#handleContactClick">handleContactClick</a></li><li><a href="global.html#hideAddContactFormular">hideAddContactFormular</a></li><li><a href="global.html#hideEditContactFormular">hideEditContactFormular</a></li><li><a href="global.html#hideToastLater">hideToastLater</a></li><li><a href="global.html#hydrateAssignSection">hydrateAssignSection</a></li><li><a href="global.html#isDemoTask">isDemoTask</a></li><li><a href="global.html#isPublicPage">isPublicPage</a></li><li><a href="global.html#isTechnicalType">isTechnicalType</a></li><li><a href="global.html#isUserStoryType">isUserStoryType</a></li><li><a href="global.html#isValidName">isValidName</a></li><li><a href="global.html#jumpToLogin">jumpToLogin</a></li><li><a href="global.html#lastDragPointerX">lastDragPointerX</a></li><li><a href="global.html#loadTasks">loadTasks</a></li><li><a href="global.html#loadTasksFromFirebase">loadTasksFromFirebase</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#makeFirstLetterBig">makeFirstLetterBig</a></li><li><a href="global.html#mapCategoryToType">mapCategoryToType</a></li><li><a href="global.html#matchesSearch">matchesSearch</a></li><li><a href="global.html#nameOfTheCard">nameOfTheCard</a></li><li><a href="global.html#needsDraggingClassAfterRender">needsDraggingClassAfterRender</a></li><li><a href="global.html#normaliseSubtaskProgress">normaliseSubtaskProgress</a></li><li><a href="global.html#normalizeTaskType">normalizeTaskType</a></li><li><a href="global.html#onclickFunction">onclickFunction</a></li><li><a href="global.html#onloadFunctionHeader">onloadFunctionHeader</a></li><li><a href="global.html#openAddTask">openAddTask</a></li><li><a href="global.html#openDynamicTaskModal">openDynamicTaskModal</a></li><li><a href="global.html#openEditOverlay">openEditOverlay</a></li><li><a href="global.html#openLegacyTaskModal">openLegacyTaskModal</a></li><li><a href="global.html#openModalById">openModalById</a></li><li><a href="global.html#openModalDynamic">openModalDynamic</a></li><li><a href="global.html#openTaskModalWithTask">openTaskModalWithTask</a></li><li><a href="global.html#parseDueDate">parseDueDate</a></li><li><a href="global.html#pendingAutoMoveStatus">pendingAutoMoveStatus</a></li><li><a href="global.html#pendingDragTiltClass">pendingDragTiltClass</a></li><li><a href="global.html#persistContacts">persistContacts</a></li><li><a href="global.html#persistTasks">persistTasks</a></li><li><a href="global.html#pollSummary">pollSummary</a></li><li><a href="global.html#prepareEditState">prepareEditState</a></li><li><a href="global.html#prevOnload">prevOnload</a></li><li><a href="global.html#priorit%25C3%25A4tIcon">prioritätIcon</a></li><li><a href="global.html#pushExampleContactsOneTimeInLocalStorage">pushExampleContactsOneTimeInLocalStorage</a></li><li><a href="global.html#putUsernameInContactList">putUsernameInContactList</a></li><li><a href="global.html#removeContentfromAllContactBlocks">removeContentfromAllContactBlocks</a></li><li><a href="global.html#removeTaskCard">removeTaskCard</a></li><li><a href="global.html#render">render</a></li><li><a href="global.html#renderAddContact">renderAddContact</a></li><li><a href="global.html#renderCard">renderCard</a></li><li><a href="global.html#renderContactList">renderContactList</a></li><li><a href="global.html#renderEditContact">renderEditContact</a></li><li><a href="global.html#renderModalContent">renderModalContent</a></li><li><a href="global.html#renderSingleContact">renderSingleContact</a></li><li><a href="global.html#renderUserMenuePopupMenu">renderUserMenuePopupMenu</a></li><li><a href="global.html#requestBoardRender">requestBoardRender</a></li><li><a href="global.html#resetAddTaskGlobals">resetAddTaskGlobals</a></li><li><a href="global.html#resetError">resetError</a></li><li><a href="global.html#restoreSubtasksState">restoreSubtasksState</a></li><li><a href="global.html#saveTaskEdits">saveTaskEdits</a></li><li><a href="global.html#scheduleAutoMoveTo">scheduleAutoMoveTo</a></li><li><a href="global.html#searchQuery">searchQuery</a></li><li><a href="global.html#seedDemoFriendsIfEmpty">seedDemoFriendsIfEmpty</a></li><li><a href="global.html#setActiveSidebarByURL">setActiveSidebarByURL</a></li><li><a href="global.html#setContactsIntoContactblock">setContactsIntoContactblock</a></li><li><a href="global.html#setLetterInUserBall">setLetterInUserBall</a></li><li><a href="global.html#setSummaryText">setSummaryText</a></li><li><a href="global.html#setUserDataValue">setUserDataValue</a></li><li><a href="global.html#setupAddTaskContent">setupAddTaskContent</a></li><li><a href="global.html#showAddContactFormular">showAddContactFormular</a></li><li><a href="global.html#showContactToast">showContactToast</a></li><li><a href="global.html#showEditContactFormular">showEditContactFormular</a></li><li><a href="global.html#showError">showError</a></li><li><a href="global.html#showTaskModal">showTaskModal</a></li><li><a href="global.html#showToast">showToast</a></li><li><a href="global.html#singleContactTemplate">singleContactTemplate</a></li><li><a href="global.html#sortUserToAlphabeticalOrder">sortUserToAlphabeticalOrder</a></li><li><a href="global.html#startEditTask">startEditTask</a></li><li><a href="global.html#startSummaryPolling">startSummaryPolling</a></li><li><a href="global.html#statusByColumnId">statusByColumnId</a></li><li><a href="global.html#toggleContactHighlight">toggleContactHighlight</a></li><li><a href="global.html#toggleUserMenuePopupMenu">toggleUserMenuePopupMenu</a></li><li><a href="global.html#updateButtonState">updateButtonState</a></li><li><a href="global.html#updateErrorForSignup">updateErrorForSignup</a></li><li><a href="global.html#updateFriendsForCurrentUser">updateFriendsForCurrentUser</a></li><li><a href="global.html#updateSearchClearButtonState">updateSearchClearButtonState</a></li><li><a href="global.html#updateSummary">updateSummary</a></li><li><a href="global.html#updateTimeout">updateTimeout</a></li><li><a href="global.html#updateUserFriendslistByUid">updateUserFriendslistByUid</a></li><li><a href="global.html#updateUserMenuPosition">updateUserMenuPosition</a></li><li><a href="global.html#userMenuTemplate">userMenuTemplate</a></li><li><a href="global.html#validateEmailInForm">validateEmailInForm</a></li><li><a href="global.html#validateEmailOnSubmit">validateEmailOnSubmit</a></li><li><a href="global.html#validateNameAndPasswordOnSubmit">validateNameAndPasswordOnSubmit</a></li><li><a href="global.html#whichCardActuellDrop">whichCardActuellDrop</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Wed Dec 10 2025 16:29:03 GMT+0100 (Mitteleuropäische Normalzeit)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
