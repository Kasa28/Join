<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: scripts/summary.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: scripts/summary.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
/**
 * @typedef {"todo"|"in-progress"|"await-feedback"|"done"} TaskStatus
 */

/**
 * @typedef {"urgent"|"medium"|"low"} TaskPriority
 */

/**
 * @typedef {Object} Task
 * @property {number|string} id
 * @property {string} [title]
 * @property {TaskStatus} status
 * @property {TaskPriority|string} priority
 * @property {string} [dueDate] - Format: "dd/mm/yyyy"
 */

/**
 * @typedef {Object} TaskCounts
 * @property {number} total
 * @property {number} urgent
 * @property {number} todo
 * @property {number} inProgress
 * @property {number} feedback
 * @property {number} done
 */
window.addEventListener("DOMContentLoaded", () => {
  updateSummary();
});


/**
 * Loads tasks from Firebase. Normalizes priority to lowercase.
 * Falls back to a minimal demo task if Firebase returns empty.
 * @async
 * @returns {Promise&lt;Task[]>}
 */
async function loadTasks() {
  try {
    const response = await fetch(
      "https://join-a3ae3-default-rtdb.europe-west1.firebasedatabase.app/tasks.json"
    );
    const data = await response.json();
    const firebaseTasks = Array.isArray(data)
      ? data.filter(Boolean)
      : data
      ? Object.values(data)
      : [];
    firebaseTasks.forEach((t) => {
      if (t &amp;&amp; typeof t.priority === "string") {
        t.priority = t.priority.toLowerCase();
      }
    });
    return firebaseTasks.length
      ? firebaseTasks
      : [
          {
            id: 1,
            title: "Demo Task",
            status: "todo",
            priority: "urgent",
            dueDate: "02/09/2023",
          },
        ];
  } catch (error) {
    console.error("Fehler beim Laden der Tasks aus Firebase:", error);
    return [];
  }
}


/**
 * Calculates task counts for summary KPIs.
 * @param {Task[]} tasks
 * @returns {TaskCounts}
 */
function getTaskCounts(tasks) {
  const counts = {
    total: tasks.length,
    urgent: 0,
    todo: 0,
    inProgress: 0,
    feedback: 0,
    done: 0,
  };
  for (const t of tasks) {
    const prio = String(t.priority || "").toLowerCase();
    if (prio === "urgent") counts.urgent++;
    switch (t.status) {
      case "todo":
        counts.todo++;
        break;
      case "in-progress":
        counts.inProgress++;
        break;
      case "await-feedback":
        counts.feedback++;
        break;
      case "done":
        counts.done++;
        break;
    }
  }
  return counts;
}


/**
 * Returns the closest due date among urgent tasks.
 * @param {Task[]} tasks
 * @returns {Date|null}
 */
function getNextDeadline(tasks) {
  const urgentTasks = tasks
    .filter(
      (t) => String(t.priority || "").toLowerCase() === "urgent" &amp;&amp; t.dueDate
    )
    .map((t) => {
      const [day, month, year] = t.dueDate.split("/");
      return new Date(`${year}-${month}-${day}`);
    })
    .filter((d) => !isNaN(d.getTime()));
  if (!urgentTasks.length) return null;
  urgentTasks.sort((a, b) => a - b);
  return urgentTasks[0];
}


/**
 * Sets textContent for a selector if element exists.
 * @param {string} selector
 * @param {string|number} value
 * @returns {void}
 */
function setSummaryText(selector, value) {
  const el = document.querySelector(selector);
  if (el) el.textContent = value;
}


/**
 * Loads tasks, computes summary KPIs and renders them into the DOM.
 * @async
 * @returns {Promise&lt;void>}
 */
async function updateSummary() {
  const tasks = await loadTasks();
  const counts = getTaskCounts(tasks);
  const nextDeadline = getNextDeadline(tasks);
  setSummaryText(".urgent-task-card-summary .h2-font-summray", counts.urgent);
  setSummaryText(".tasks-on-board-card-summary .h2-font-summray", counts.total);
  setSummaryText(
    ".summary-section-2-order .summary-card:nth-child(1) .h2-font-summray",
    counts.todo
  );
  setSummaryText(
    ".summary-section-2-order .summary-card:nth-child(2) .h2-font-summray",
    counts.inProgress
  );
  setSummaryText(
    ".summary-section-2-order .summary-card:nth-child(3) .h2-font-summray",
    counts.feedback
  );
  setSummaryText(
    ".summary-section-2-order .summary-card:nth-child(4) .h2-font-summray",
    counts.done
  );
  const deadlineEl = document.querySelector(".date-font-summary");
  if (deadlineEl) {
    if (nextDeadline) {
      const options = { year: "numeric", month: "long", day: "numeric" };
      deadlineEl.textContent = nextDeadline.toLocaleDateString(
        "en-US",
        options
      );
    } else {
      deadlineEl.textContent = "No urgent deadlines";
    }
  }
  console.log("Summary updated:", counts);
}

let lastDataString = "";


/**
 * Polls Firebase for changes and updates summary if data differs.
 * @async
 * @returns {Promise&lt;void>}
 */
async function pollSummary() {
  try {
    const res = await fetch(
      "https://join-a3ae3-default-rtdb.europe-west1.firebasedatabase.app/tasks.json"
    );
    const data = await res.json();
    const json = JSON.stringify(data);
    if (json !== lastDataString) {
      lastDataString = json;
      await updateSummary();
    }
  } catch (err) {
    console.warn("Polling error (summary):", err);
  }
}


pollSummary();
setInterval(pollSummary, 3000);
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#BASE_URL">BASE_URL</a></li><li><a href="global.html#activeHighlightColumnId">activeHighlightColumnId</a></li><li><a href="global.html#addActiveClassToSidebarButtons">addActiveClassToSidebarButtons</a></li><li><a href="global.html#addContactToLocalStorageAndAPI">addContactToLocalStorageAndAPI</a></li><li><a href="global.html#addNewContact">addNewContact</a></li><li><a href="global.html#afterRender">afterRender</a></li><li><a href="global.html#applyStatusChangeForDraggedTask">applyStatusChangeForDraggedTask</a></li><li><a href="global.html#assignedToDataExtractSafe">assignedToDataExtractSafe</a></li><li><a href="global.html#autoMoveTimeoutId">autoMoveTimeoutId</a></li><li><a href="global.html#bigCardDynamicHtml">bigCardDynamicHtml</a></li><li><a href="global.html#bigCardDynamicTechnicalHtml">bigCardDynamicTechnicalHtml</a></li><li><a href="global.html#bigCardHtml">bigCardHtml</a></li><li><a href="global.html#buildSubtaskListItem">buildSubtaskListItem</a></li><li><a href="global.html#callWhiteScreen">callWhiteScreen</a></li><li><a href="global.html#cancelScheduledAutoMove">cancelScheduledAutoMove</a></li><li><a href="global.html#checkIfBlockIsFilled">checkIfBlockIsFilled</a></li><li><a href="global.html#checkIfLogedIn">checkIfLogedIn</a></li><li><a href="global.html#checkLogin">checkLogin</a></li><li><a href="global.html#checkPolicyandAnswers">checkPolicyandAnswers</a></li><li><a href="global.html#checkUsernamePassword">checkUsernamePassword</a></li><li><a href="global.html#clearAllColumnHighlights">clearAllColumnHighlights</a></li><li><a href="global.html#clearForm">clearForm</a></li><li><a href="global.html#closeAddTask">closeAddTask</a></li><li><a href="global.html#closeModal">closeModal</a></li><li><a href="global.html#closeTaskModal">closeTaskModal</a></li><li><a href="global.html#closeWhiteScreen">closeWhiteScreen</a></li><li><a href="global.html#collectTaskFromForm">collectTaskFromForm</a></li><li><a href="global.html#contactBlock">contactBlock</a></li><li><a href="global.html#createTask">createTask</a></li><li><a href="global.html#createUser">createUser</a></li><li><a href="global.html#currentDragCardEl">currentDragCardEl</a></li><li><a href="global.html#currentlySelectedContact">currentlySelectedContact</a></li><li><a href="global.html#deleteContact">deleteContact</a></li><li><a href="global.html#deleteContactinEditContactWindow">deleteContactinEditContactWindow</a></li><li><a href="global.html#deleteDynamicTask">deleteDynamicTask</a></li><li><a href="global.html#deleteIdFromLocalStorage">deleteIdFromLocalStorage</a></li><li><a href="global.html#deleteTask">deleteTask</a></li><li><a href="global.html#demoContactTemplate">demoContactTemplate</a></li><li><a href="global.html#demoTasks">demoTasks</a></li><li><a href="global.html#editContact">editContact</a></li><li><a href="global.html#emptyTheAddContactFormular">emptyTheAddContactFormular</a></li><li><a href="global.html#enableSubtaskEditing">enableSubtaskEditing</a></li><li><a href="global.html#fallbackModal">fallbackModal</a></li><li><a href="global.html#fillArray">fillArray</a></li><li><a href="global.html#filterAssignList">filterAssignList</a></li><li><a href="global.html#finalizeAssignSearch">finalizeAssignSearch</a></li><li><a href="global.html#findColumnByPointer">findColumnByPointer</a></li><li><a href="global.html#findIndexFromUsername">findIndexFromUsername</a></li><li><a href="global.html#generateTaskId">generateTaskId</a></li><li><a href="global.html#getAddTaskTemplate">getAddTaskTemplate</a></li><li><a href="global.html#getAllTasks">getAllTasks</a></li><li><a href="global.html#getAllUsers">getAllUsers</a></li><li><a href="global.html#getAssignSearchValue">getAssignSearchValue</a></li><li><a href="global.html#getBadgeClass">getBadgeClass</a></li><li><a href="global.html#getBigCardDynamicHtml">getBigCardDynamicHtml</a></li><li><a href="global.html#getBigCardDynamicTechnicalHtml">getBigCardDynamicTechnicalHtml</a></li><li><a href="global.html#getColorFromItem">getColorFromItem</a></li><li><a href="global.html#getContactColorType">getContactColorType</a></li><li><a href="global.html#getDraggedTask">getDraggedTask</a></li><li><a href="global.html#getInitials">getInitials</a></li><li><a href="global.html#getInitialsFromName">getInitialsFromName</a></li><li><a href="global.html#getNextDeadline">getNextDeadline</a></li><li><a href="global.html#getRandomInt">getRandomInt</a></li><li><a href="global.html#getSubtasksSafe">getSubtasksSafe</a></li><li><a href="global.html#getTaskCounts">getTaskCounts</a></li><li><a href="global.html#getTechnicalTaskTemplate">getTechnicalTaskTemplate</a></li><li><a href="global.html#getUserID">getUserID</a></li><li><a href="global.html#getWhiteScreen">getWhiteScreen</a></li><li><a href="global.html#greetUserName">greetUserName</a></li><li><a href="global.html#handleAssignInput">handleAssignInput</a></li><li><a href="global.html#handleContactClick">handleContactClick</a></li><li><a href="global.html#hideAddContactFormular">hideAddContactFormular</a></li><li><a href="global.html#hideEditContactFormular">hideEditContactFormular</a></li><li><a href="global.html#hydrateAssignSection">hydrateAssignSection</a></li><li><a href="global.html#initAddTaskTemplateHandlers">initAddTaskTemplateHandlers</a></li><li><a href="global.html#isAssignPlaceholderEvent">isAssignPlaceholderEvent</a></li><li><a href="global.html#isDemoTask">isDemoTask</a></li><li><a href="global.html#isRealDate">isRealDate</a></li><li><a href="global.html#isTechnicalType">isTechnicalType</a></li><li><a href="global.html#isUserStoryType">isUserStoryType</a></li><li><a href="global.html#isValidDateFormat">isValidDateFormat</a></li><li><a href="global.html#jumpToLogin">jumpToLogin</a></li><li><a href="global.html#lastDragPointerX">lastDragPointerX</a></li><li><a href="global.html#loadTasks">loadTasks</a></li><li><a href="global.html#loadTasksFromFirebase">loadTasksFromFirebase</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#loginAsGuest">loginAsGuest</a></li><li><a href="global.html#makeFirstLetterBig">makeFirstLetterBig</a></li><li><a href="global.html#mapCategoryToType">mapCategoryToType</a></li><li><a href="global.html#matchesSearch">matchesSearch</a></li><li><a href="global.html#nameOfTheCard">nameOfTheCard</a></li><li><a href="global.html#needsDraggingClassAfterRender">needsDraggingClassAfterRender</a></li><li><a href="global.html#normaliseSubtaskProgress">normaliseSubtaskProgress</a></li><li><a href="global.html#normalizeTaskType">normalizeTaskType</a></li><li><a href="global.html#onclickFunction">onclickFunction</a></li><li><a href="global.html#onloadFunctionHeader">onloadFunctionHeader</a></li><li><a href="global.html#openAddTask">openAddTask</a></li><li><a href="global.html#openModalDynamic">openModalDynamic</a></li><li><a href="global.html#patchDataWithID">patchDataWithID</a></li><li><a href="global.html#pendingAutoMoveStatus">pendingAutoMoveStatus</a></li><li><a href="global.html#pendingDragTiltClass">pendingDragTiltClass</a></li><li><a href="global.html#persistTasks">persistTasks</a></li><li><a href="global.html#pollSummary">pollSummary</a></li><li><a href="global.html#populateEditOverlay">populateEditOverlay</a></li><li><a href="global.html#postDataWithID">postDataWithID</a></li><li><a href="global.html#prevOnload">prevOnload</a></li><li><a href="global.html#priorit%25C3%25A4tIcon">priorit√§tIcon</a></li><li><a href="global.html#processAssignSearch">processAssignSearch</a></li><li><a href="global.html#pushExampleContactsOneTimeInLocalStorage">pushExampleContactsOneTimeInLocalStorage</a></li><li><a href="global.html#putUserDataIntoLocalStorage">putUserDataIntoLocalStorage</a></li><li><a href="global.html#putUsernameInContactList">putUsernameInContactList</a></li><li><a href="global.html#readSubtasksFromForm">readSubtasksFromForm</a></li><li><a href="global.html#removeContentfromAllContactBlocks">removeContentfromAllContactBlocks</a></li><li><a href="global.html#render">render</a></li><li><a href="global.html#renderAddContact">renderAddContact</a></li><li><a href="global.html#renderAssignedAvatars">renderAssignedAvatars</a></li><li><a href="global.html#renderContactList">renderContactList</a></li><li><a href="global.html#renderContactsInDropdown">renderContactsInDropdown</a></li><li><a href="global.html#renderEditContact">renderEditContact</a></li><li><a href="global.html#renderSingleContact">renderSingleContact</a></li><li><a href="global.html#renderUserMenuePopupMenu">renderUserMenuePopupMenu</a></li><li><a href="global.html#resetAssignSearch">resetAssignSearch</a></li><li><a href="global.html#sanitizeDueDateInput">sanitizeDueDateInput</a></li><li><a href="global.html#saveEditedSubtask">saveEditedSubtask</a></li><li><a href="global.html#saveTask">saveTask</a></li><li><a href="global.html#saveTaskEdits">saveTaskEdits</a></li><li><a href="global.html#scheduleAutoMoveTo">scheduleAutoMoveTo</a></li><li><a href="global.html#searchQuery">searchQuery</a></li><li><a href="global.html#selectAssignUser">selectAssignUser</a></li><li><a href="global.html#setActiveSidebarByURL">setActiveSidebarByURL</a></li><li><a href="global.html#setContactsIntoContactblock">setContactsIntoContactblock</a></li><li><a href="global.html#setLetterInUserBall">setLetterInUserBall</a></li><li><a href="global.html#setPriorityAddTask">setPriorityAddTask</a></li><li><a href="global.html#setSummaryText">setSummaryText</a></li><li><a href="global.html#setUserDataValue">setUserDataValue</a></li><li><a href="global.html#shouldResetAssignSearch">shouldResetAssignSearch</a></li><li><a href="global.html#showAddContactFormular">showAddContactFormular</a></li><li><a href="global.html#showContactToast">showContactToast</a></li><li><a href="global.html#showEditContactFormular">showEditContactFormular</a></li><li><a href="global.html#showToast">showToast</a></li><li><a href="global.html#singleContactTemplate">singleContactTemplate</a></li><li><a href="global.html#sortUserToAlphabeticalOrder">sortUserToAlphabeticalOrder</a></li><li><a href="global.html#startEditTask">startEditTask</a></li><li><a href="global.html#statusByColumnId">statusByColumnId</a></li><li><a href="global.html#subscribeToFirebaseUpdates">subscribeToFirebaseUpdates</a></li><li><a href="global.html#toggleAssignDropdown">toggleAssignDropdown</a></li><li><a href="global.html#toggleContactHighlight">toggleContactHighlight</a></li><li><a href="global.html#toggleUserMenuePopupMenu">toggleUserMenuePopupMenu</a></li><li><a href="global.html#updateAssignPlaceholder">updateAssignPlaceholder</a></li><li><a href="global.html#updateFriendsInLocalStorage">updateFriendsInLocalStorage</a></li><li><a href="global.html#updateSearchClearButtonState">updateSearchClearButtonState</a></li><li><a href="global.html#updateSummary">updateSummary</a></li><li><a href="global.html#updateTimeout">updateTimeout</a></li><li><a href="global.html#updateUserFriendslist">updateUserFriendslist</a></li><li><a href="global.html#userMenuTemplate">userMenuTemplate</a></li><li><a href="global.html#validateDueDate">validateDueDate</a></li><li><a href="global.html#whichCardActuellDrop">whichCardActuellDrop</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Fri Nov 21 2025 13:33:32 GMT+0100 (Central European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
